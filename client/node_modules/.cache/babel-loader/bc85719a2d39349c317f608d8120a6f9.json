{"ast":null,"code":"var _jsxFileName = \"/Users/metabou/Desktop/ChatterSanctum/chatapp/client/src/components/Chatroom/Chatroom.js\";\nimport React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport * as actions from '../../redux';\nimport { ROOT_URL } from '../../config/networkSettings';\nimport io from \"socket.io-client\";\nimport Moment from 'react-moment';\nimport 'moment-timezone';\nimport UserModal from '../../components/UserModal/UserModal';\nimport './Chatroom.css';\nimport chatot from '../../assets/images/chatot.png';\nimport numbersign from '../../assets/images/numbersign.png';\n\nclass Chatroom extends Component {\n  constructor(props) {\n    super(props);\n\n    this.sendMessage = event => {\n      if (event) {\n        event.preventDefault();\n        this.socket.emit('CHATROOM_MESSAGE', {\n          username: this.props.username,\n          message: this.state.message,\n          userId: this.props.userId,\n          chatroomId: this.state.chatroomId,\n          room: this.state.room\n        });\n        this.setState({\n          message: \"\"\n        });\n      }\n    };\n\n    this.contextMenu = (event, item) => {\n      event.preventDefault();\n      this.setState({\n        rightClickedUser: item,\n        userModalOpen: true\n      });\n    };\n\n    this.privateMessageUser = () => {\n      this.setState({\n        messages: []\n      });\n      this.props.privateMessageUser(this.state.rightClickedUser);\n    };\n\n    this.state = {\n      id: \"\",\n      username: \"\",\n      active: false,\n      type: \"\",\n      imageUrl: \"\",\n      message: \"\",\n      messages: [],\n      users: [],\n      clickedUsername: \"\",\n      clickedType: \"\",\n      privateMessages: [],\n      personalMessages: [],\n      userDetails: false,\n      socketId: \"\",\n      currentSocket: \"\",\n      rightClickedUser: {},\n      userModalOpen: false,\n      namespace: null,\n      room: null,\n      serverId: null,\n      currentChatroom: null,\n      chatroomId: null\n    };\n  }\n\n  async componentDidMount() {\n    console.log('mounted');\n    this.props.currentUser();\n    this.props.getUsers();\n    this.socket = io(ROOT_URL);\n    this.socket.on('connect', () => {\n      this.setState({\n        socketId: this.socket.id,\n        namespace: \"\".concat(ROOT_URL, \"/\").concat(this.props.serverId),\n        room: \"\".concat(ROOT_URL, \"/\").concat(this.props.serverId, \"/\").concat(this.props.activeChatroom),\n        serverId: this.props.serverId,\n        currentChatroom: this.props.activeChatroom,\n        chatroomId: this.props.chatroomId\n      }); // this.socket.room = `${ROOT_URL}/${this.props.activeChatroomId}`;\n      // this.setState({ room: `${ROOT_URL}/${this.props.activeChatroomId}` });\n      // console.log(this.socket);\n      // this.socket.emitjoin(this.state.room, () => {\n      //   console.log(this.socket.id + \" now in rooms \", this.socket.rooms);\n      // });\n    });\n    this.socket.emit('GET_CHATROOM_MESSAGES', {\n      chatroomId: this.props.activeChatroomId,\n      room: \"\".concat(ROOT_URL, \"/\").concat(this.props.serverId, \"/\").concat(this.props.activeChatroom)\n    });\n    this.socket.on('RECEIVE_CHATROOM_MESSAGES', data => {\n      console.log(data, ' received here'); // scroll to latest message after rendering messages in firefox\n\n      if (navigator.userAgent.search(\"Firefox\") > -1) {\n        this.setState({\n          messages: data.reverse()\n        }, () => {\n          if (data && data.length > 0) {\n            const element = \"message\" + (this.state.messages.length - 1);\n\n            if (document.getElementById(element)) {\n              document.getElementById(element).scrollIntoView();\n            }\n          }\n        });\n      } else if (navigator.userAgent.search(\"Firefox\") < 0) {\n        this.setState({\n          messages: data\n        });\n      }\n    });\n  }\n\n  async componentWillReceiveProps(nextProps) {\n    if (nextProps.activeChatroom !== this.state.currentChatroom) {\n      this.setState({\n        room: \"\".concat(ROOT_URL, \"/\").concat(this.state.serverId, \"/\").concat(this.state.activeChatroom),\n        serverId: nextProps.serverId,\n        currentChatroom: nextProps.activeChatroom\n      });\n      this.socket.emit('GET_CHATROOM_MESSAGES', {\n        chatroomId: nextProps.activeChatroomId,\n        room: \"\".concat(ROOT_URL, \"/\").concat(nextProps.serverId, \"/\").concat(nextProps.activeChatroom)\n      });\n    } // if (nextProps.activeChatroomId) {\n    //   this.socket.emit('GET_CHATROOM_MESSAGES', {\n    //     chatroomId: nextProps.activeChatroomId\n    //   });\n    // }\n\n\n    if (nextProps.user) {\n      const _nextProps$user = nextProps.user,\n            id = _nextProps$user.id,\n            username = _nextProps$user.username,\n            active = _nextProps$user.active,\n            type = _nextProps$user.type;\n      this.setState({\n        id: id,\n        username: username,\n        active: active,\n        type: type\n      });\n    }\n\n    if (nextProps.users && nextProps.users.length) {\n      const userList = [];\n\n      for (let i = 0; i < nextProps.users.length; i++) {\n        userList.push(nextProps.users[i]);\n      }\n\n      this.setState({\n        users: userList\n      });\n    }\n  }\n\n  componentWillUnmount() {\n    this.socket.emit('LEAVE_CHATROOM', {\n      room: this.state.room\n    });\n    this.setState({\n      namespace: null,\n      room: null\n    });\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      className: \"chatroom\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 159\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"chatarea\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 160\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"chatarea-topbar\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 161\n      },\n      __self: this\n    }, React.createElement(\"img\", {\n      src: numbersign,\n      alt: \"channel\",\n      height: 16,\n      width: 16,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 162\n      },\n      __self: this\n    }), React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 162\n      },\n      __self: this\n    }, this.props.activeChatroom)), React.createElement(\"div\", {\n      id: \"chatareamessages\",\n      className: \"chatarea-messages\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 164\n      },\n      __self: this\n    }, this.state.messages && this.state.messages.length > 0 ? this.state.messages.map((item, index) => {\n      return React.createElement(\"div\", {\n        id: \"message\" + index,\n        key: index,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 167\n        },\n        __self: this\n      }, React.createElement(\"p\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 168\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        className: \"chatarea-messages-user\",\n        onClick: this.handleClick,\n        onContextMenu: event => {\n          this.contextMenu(event, item);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 168\n        },\n        __self: this\n      }, item.username), \" \", React.createElement(Moment, {\n        format: \"MM/DD/YYYY\",\n        className: \"chatarea-messages-time\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 168\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 168\n        },\n        __self: this\n      }, item.createdAt))), React.createElement(\"p\", {\n        className: \"chatarea-messages-message\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 169\n        },\n        __self: this\n      }, item.message));\n    }) : null), React.createElement(\"div\", {\n      className: \"chatarea-container\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 174\n      },\n      __self: this\n    }, React.createElement(\"input\", {\n      placeholder: \"Send a message!\",\n      type: \"text\",\n      onChange: event => {\n        this.setState({\n          message: event.target.value\n        });\n      },\n      value: this.state.message,\n      onKeyDown: event => {\n        event.keyCode === 13 && event.shiftKey === false ? this.sendMessage(event) : this.sendMessage(null);\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 175\n      },\n      __self: this\n    }))), React.createElement(\"div\", {\n      className: \"sidebarright\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 178\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"sidebarright-container\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 179\n      },\n      __self: this\n    }, React.createElement(\"input\", {\n      placeholder: \"Filter users in server\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 180\n      },\n      __self: this\n    })), React.createElement(\"div\", {\n      className: \"sidebarright-border\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 182\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      className: \"sidebarright-authority\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 183\n      },\n      __self: this\n    }, React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 184\n      },\n      __self: this\n    }, \"Room Owners\")), React.createElement(\"div\", {\n      className: \"sidebarright-bordertwo\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 186\n      },\n      __self: this\n    }), this.props.serverUserList.length > 0 ? this.props.serverUserList.map((user, index) => {\n      return React.createElement(\"div\", {\n        key: index,\n        className: user.type === 'owner' ? \"sidebarright-usercontainer\" : \"\",\n        onClick: this.handleClick,\n        onContextMenu: event => {\n          this.contextMenu(event, user);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 189\n        },\n        __self: this\n      }, user.type === 'owner' ? React.createElement(\"div\", {\n        className: \"username\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 190\n        },\n        __self: this\n      }, React.createElement(\"img\", {\n        className: \"username-image\",\n        src: user.imageUrl ? user.imageUrl : chatot,\n        alt: \"username-icon\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 191\n        },\n        __self: this\n      })) : null, user.type === 'owner' && user.active ? React.createElement(\"div\", {\n        className: \"userinfo-online\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 193\n        },\n        __self: this\n      }) : null, user.type === 'owner' && !user.active ? React.createElement(\"div\", {\n        className: \"userinfo-offline\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 194\n        },\n        __self: this\n      }) : null, user.type === 'owner' ? React.createElement(\"span\", {\n        className: \"sidebarright-user\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 195\n        },\n        __self: this\n      }, user.username) : null);\n    }) : null, React.createElement(\"div\", {\n      className: \"sidebarright-authority\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 199\n      },\n      __self: this\n    }, React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 200\n      },\n      __self: this\n    }, \"Administrators\")), React.createElement(\"div\", {\n      className: \"sidebarright-bordertwo\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 202\n      },\n      __self: this\n    }), this.props.serverUserList.length > 0 ? this.props.serverUserList.map((user, index) => {\n      return React.createElement(\"div\", {\n        key: index,\n        className: user.type === 'admin' ? \"sidebarright-usercontainer\" : \"\",\n        onClick: this.handleClick,\n        onContextMenu: event => {\n          this.contextMenu(event, user);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 205\n        },\n        __self: this\n      }, user.type === 'admin' ? React.createElement(\"div\", {\n        className: \"username\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 206\n        },\n        __self: this\n      }, React.createElement(\"img\", {\n        className: \"username-image\",\n        src: user.imageUrl ? user.imageUrl : chatot,\n        alt: \"username-icon\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 207\n        },\n        __self: this\n      })) : null, user.type === 'admin' && user.active ? React.createElement(\"div\", {\n        className: \"userinfo-online\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 209\n        },\n        __self: this\n      }) : null, user.type === 'admin' && !user.active ? React.createElement(\"div\", {\n        className: \"userinfo-offline\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 210\n        },\n        __self: this\n      }) : null, user.type === 'admin' ? React.createElement(\"span\", {\n        className: \"sidebarright-user\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 211\n        },\n        __self: this\n      }, user.username) : null);\n    }) : null, React.createElement(\"div\", {\n      className: \"sidebarright-authority\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 215\n      },\n      __self: this\n    }, React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 216\n      },\n      __self: this\n    }, \"Moderators\")), React.createElement(\"div\", {\n      className: \"sidebarright-bordertwo\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 218\n      },\n      __self: this\n    }), this.state.users.length > 0 ? this.state.users.map((user, index) => {\n      return React.createElement(\"div\", {\n        key: index,\n        className: user.type === 'moderator' ? \"sidebarright-usercontainer\" : \"\",\n        onClick: this.handleClick,\n        onContextMenu: event => {\n          this.contextMenu(event, user);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 221\n        },\n        __self: this\n      }, user.type === 'moderator' ? React.createElement(\"div\", {\n        className: \"username\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 222\n        },\n        __self: this\n      }, React.createElement(\"img\", {\n        className: \"username-image\",\n        src: user.imageUrl ? user.imageUrl : chatot,\n        alt: \"username-icon\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 223\n        },\n        __self: this\n      })) : null, user.type === 'moderator' && user.active ? React.createElement(\"div\", {\n        className: \"userinfo-online\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 225\n        },\n        __self: this\n      }) : null, user.type === 'moderator' && !user.active ? React.createElement(\"div\", {\n        className: \"userinfo-offline\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 226\n        },\n        __self: this\n      }) : null, user.type === 'moderator' ? React.createElement(\"span\", {\n        className: \"sidebarright-user\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 227\n        },\n        __self: this\n      }, user.username) : null);\n    }) : null, React.createElement(\"div\", {\n      className: \"sidebarright-authority\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 231\n      },\n      __self: this\n    }, React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 232\n      },\n      __self: this\n    }, \"Voice\")), React.createElement(\"div\", {\n      className: \"sidebarright-bordertwo\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 234\n      },\n      __self: this\n    }), this.props.serverUserList.length > 0 ? this.props.serverUserList.map((user, index) => {\n      return React.createElement(\"div\", {\n        key: index,\n        className: user.type === 'voice' ? \"sidebarright-usercontainer\" : \"\",\n        onClick: this.handleClick,\n        onContextMenu: event => {\n          this.contextMenu(event, user);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 237\n        },\n        __self: this\n      }, user.type === 'voice' ? React.createElement(\"div\", {\n        className: \"username\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 238\n        },\n        __self: this\n      }, React.createElement(\"img\", {\n        className: \"username-image\",\n        src: user.imageUrl ? user.imageUrl : chatot,\n        alt: \"username-icon\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 239\n        },\n        __self: this\n      })) : null, user.type === 'voice' && user.active ? React.createElement(\"div\", {\n        className: \"userinfo-online\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 241\n        },\n        __self: this\n      }) : null, user.type === 'voice' && !user.active ? React.createElement(\"div\", {\n        className: \"userinfo-offline\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 242\n        },\n        __self: this\n      }) : null, user.type === 'voice' ? React.createElement(\"span\", {\n        className: \"sidebarright-user\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 243\n        },\n        __self: this\n      }, user.username) : null);\n    }) : null, React.createElement(\"div\", {\n      className: \"sidebarright-authority\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 247\n      },\n      __self: this\n    }, React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 248\n      },\n      __self: this\n    }, \"Users\")), React.createElement(\"div\", {\n      className: \"sidebarright-bordertwo\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 250\n      },\n      __self: this\n    }), this.props.serverUserList.length > 0 ? this.props.serverUserList.map((user, index) => {\n      return React.createElement(\"div\", {\n        key: index,\n        className: user.type === 'user' ? \"sidebarright-usercontainer\" : \"\",\n        onClick: this.handleClick,\n        onContextMenu: event => {\n          this.contextMenu(event, user);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 253\n        },\n        __self: this\n      }, user.type === 'user' ? React.createElement(\"div\", {\n        className: \"username\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 254\n        },\n        __self: this\n      }, React.createElement(\"img\", {\n        className: \"username-image\",\n        src: user.imageUrl ? user.imageUrl : chatot,\n        alt: \"username-icon\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 255\n        },\n        __self: this\n      })) : null, user.type === 'user' && user.active ? React.createElement(\"div\", {\n        className: \"userinfo-online\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 257\n        },\n        __self: this\n      }) : null, user.type === 'user' && !user.active ? React.createElement(\"div\", {\n        className: \"userinfo-offline\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 258\n        },\n        __self: this\n      }) : null, user.type === 'user' ? React.createElement(\"span\", {\n        className: \"sidebarright-user\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 259\n        },\n        __self: this\n      }, user.username) : null);\n    }) : null), this.state.userModalOpen ? React.createElement(UserModal, {\n      userId: this.state.rightClickedUser.userId,\n      username: this.state.rightClickedUser.username,\n      setUserModalOpen: () => {\n        this.setState({\n          userModalOpen: false\n        });\n      },\n      setPrivateMessageUser: () => {\n        this.privateMessageUser();\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 265\n      },\n      __self: this\n    }) : null);\n  }\n\n}\n\nfunction mapStateToProps({\n  usersReducer\n}) {\n  return {\n    error: usersReducer.error,\n    isLoading: usersReducer.isLoading,\n    success: usersReducer.success,\n    user: usersReducer.user,\n    users: usersReducer.users\n  };\n}\n\nexport default connect(mapStateToProps, actions)(Chatroom);","map":{"version":3,"sources":["/Users/metabou/Desktop/ChatterSanctum/chatapp/client/src/components/Chatroom/Chatroom.js"],"names":["React","Component","connect","actions","ROOT_URL","io","Moment","UserModal","chatot","numbersign","Chatroom","constructor","props","sendMessage","event","preventDefault","socket","emit","username","message","state","userId","chatroomId","room","setState","contextMenu","item","rightClickedUser","userModalOpen","privateMessageUser","messages","id","active","type","imageUrl","users","clickedUsername","clickedType","privateMessages","personalMessages","userDetails","socketId","currentSocket","namespace","serverId","currentChatroom","componentDidMount","console","log","currentUser","getUsers","on","activeChatroom","activeChatroomId","data","navigator","userAgent","search","reverse","length","element","document","getElementById","scrollIntoView","componentWillReceiveProps","nextProps","user","userList","i","push","componentWillUnmount","render","map","index","handleClick","createdAt","target","value","keyCode","shiftKey","serverUserList","mapStateToProps","usersReducer","error","isLoading","success"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport * as actions from '../../redux';\nimport { ROOT_URL } from '../../config/networkSettings';\nimport io from \"socket.io-client\";\nimport Moment from 'react-moment';\nimport 'moment-timezone';\nimport UserModal from '../../components/UserModal/UserModal';\nimport './Chatroom.css';\nimport chatot from '../../assets/images/chatot.png';\nimport numbersign from '../../assets/images/numbersign.png';\n\nclass Chatroom extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      id: \"\",\n      username: \"\",\n      active: false,\n      type: \"\",\n      imageUrl: \"\",\n      message: \"\",\n      messages: [],\n      users: [],\n      clickedUsername: \"\",\n      clickedType: \"\",\n      privateMessages: [],\n      personalMessages: [],\n      userDetails: false,\n      socketId: \"\",\n      currentSocket: \"\",\n      rightClickedUser: {},\n      userModalOpen: false,\n      namespace: null,\n      room: null,\n      serverId: null,\n      currentChatroom: null,\n      chatroomId: null\n    }\n  }\n\n  async componentDidMount() {\n    console.log('mounted');\n    this.props.currentUser();\n    this.props.getUsers();\n\n    this.socket = io(ROOT_URL);\n\n    this.socket.on('connect', () => {\n      this.setState({ socketId: this.socket.id, namespace: `${ROOT_URL}/${this.props.serverId}`, room: `${ROOT_URL}/${this.props.serverId}/${this.props.activeChatroom}`, serverId: this.props.serverId, currentChatroom: this.props.activeChatroom, chatroomId: this.props.chatroomId });\n\n      // this.socket.room = `${ROOT_URL}/${this.props.activeChatroomId}`;\n      // this.setState({ room: `${ROOT_URL}/${this.props.activeChatroomId}` });\n\n      // console.log(this.socket);\n\n      // this.socket.emitjoin(this.state.room, () => {\n      //   console.log(this.socket.id + \" now in rooms \", this.socket.rooms);\n      // });\n    });\n\n    this.socket.emit('GET_CHATROOM_MESSAGES', {\n      chatroomId: this.props.activeChatroomId,\n      room: `${ROOT_URL}/${this.props.serverId}/${this.props.activeChatroom}`\n    });\n\n    this.socket.on('RECEIVE_CHATROOM_MESSAGES', (data) => {\n      console.log(data, ' received here');\n      // scroll to latest message after rendering messages in firefox\n      if (navigator.userAgent.search(\"Firefox\") > -1) {\n        this.setState({ messages: data.reverse() }, () => {\n          if (data && data.length > 0) {\n            const element = \"message\" + (this.state.messages.length - 1);\n            if (document.getElementById(element)) {\n              document.getElementById(element).scrollIntoView();\n            }\n          }\n        });\n      } else if (navigator.userAgent.search(\"Firefox\") < 0) {\n        this.setState({ messages: data });\n      }\n    });\n  }\n\n  async componentWillReceiveProps(nextProps) {\n    if (nextProps.activeChatroom !== this.state.currentChatroom) {\n      this.setState({\n        room: `${ROOT_URL}/${this.state.serverId}/${this.state.activeChatroom}`,\n        serverId: nextProps.serverId,\n        currentChatroom: nextProps.activeChatroom\n      });\n      this.socket.emit('GET_CHATROOM_MESSAGES', {\n        chatroomId: nextProps.activeChatroomId,\n        room: `${ROOT_URL}/${nextProps.serverId}/${nextProps.activeChatroom}`\n      });\n    }\n\n    // if (nextProps.activeChatroomId) {\n    //   this.socket.emit('GET_CHATROOM_MESSAGES', {\n    //     chatroomId: nextProps.activeChatroomId\n    //   });\n    // }\n    if (nextProps.user) {\n      const { id, username, active, type } = nextProps.user;\n      this.setState({\n        id: id,\n        username: username,\n        active: active,\n        type: type\n      });\n    }\n\n    if (nextProps.users && nextProps.users.length) {\n      const userList = [];\n      for(let i = 0; i < nextProps.users.length; i++) {\n        userList.push(nextProps.users[i]);\n      }\n      this.setState({ users: userList });\n    }\n  }\n\n  componentWillUnmount() {\n    this.socket.emit('LEAVE_CHATROOM', {\n      room: this.state.room\n    });\n    this.setState({\n      namespace: null,\n      room: null\n    });\n  }\n\n  sendMessage = (event) => {\n    if (event) {\n      event.preventDefault();\n      this.socket.emit('CHATROOM_MESSAGE', {\n        username: this.props.username,\n        message: this.state.message,\n        userId: this.props.userId,\n        chatroomId: this.state.chatroomId,\n        room: this.state.room\n      });\n      this.setState({ message: \"\" });\n    }\n  }\n\n  contextMenu = (event, item) => {\n    event.preventDefault();\n    this.setState({ rightClickedUser: item, userModalOpen: true });\n  }\n\n  privateMessageUser = () => {\n    this.setState({ messages: [] });\n    this.props.privateMessageUser(this.state.rightClickedUser);\n  }\n\n  render() {\n    return (\n      <div className=\"chatroom\">\n        <div className=\"chatarea\">\n          <div className=\"chatarea-topbar\">\n            <img src={numbersign} alt=\"channel\" height={16} width={16} /><span>{this.props.activeChatroom}</span>\n          </div>\n          <div id=\"chatareamessages\" className=\"chatarea-messages\">\n            {this.state.messages && this.state.messages.length > 0 ? this.state.messages.map((item, index) => {\n              return (\n                <div id={\"message\" + index} key={index}>\n                  <p><span className=\"chatarea-messages-user\" onClick={this.handleClick} onContextMenu={(event) => { this.contextMenu(event, item); }}>{item.username}</span> <Moment format=\"MM/DD/YYYY\" className=\"chatarea-messages-time\"><span>{item.createdAt}</span></Moment></p>\n                  <p className=\"chatarea-messages-message\">{item.message}</p>\n                </div>\n              )\n            }) : null}\n          </div>\n          <div className=\"chatarea-container\">\n            <input placeholder=\"Send a message!\" type=\"text\" onChange={(event) => { this.setState({ message: event.target.value }); }} value={this.state.message} onKeyDown={(event) => { event.keyCode === 13 && event.shiftKey === false ? this.sendMessage(event) : this.sendMessage(null) }}></input>\n          </div>\n        </div>\n        <div className=\"sidebarright\">\n          <div className=\"sidebarright-container\">\n            <input placeholder=\"Filter users in server\"></input>\n          </div>\n          <div className=\"sidebarright-border\" />\n          <div className=\"sidebarright-authority\">\n            <span>Room Owners</span>\n          </div>\n          <div className=\"sidebarright-bordertwo\" />\n          {this.props.serverUserList.length > 0 ? this.props.serverUserList.map((user, index)  => {\n            return (\n              <div key={index} className={user.type === 'owner' ? \"sidebarright-usercontainer\" : \"\"} onClick={this.handleClick} onContextMenu={(event) => { this.contextMenu(event, user); }}>\n                {user.type === 'owner' ? <div className=\"username\">\n                  <img className=\"username-image\" src={user.imageUrl ? user.imageUrl : chatot} alt=\"username-icon\" />\n                </div> : null}\n                {user.type === 'owner' && user.active ? <div className=\"userinfo-online\"></div> : null}\n                {user.type === 'owner' && !user.active ? <div className=\"userinfo-offline\"></div> : null}\n                {user.type === 'owner' ? <span className=\"sidebarright-user\">{user.username}</span> : null}\n              </div>\n            );\n          }) : null}\n          <div className=\"sidebarright-authority\">\n            <span>Administrators</span>\n          </div>\n          <div className=\"sidebarright-bordertwo\" />\n          {this.props.serverUserList.length > 0 ? this.props.serverUserList.map((user, index)  => {\n            return (\n              <div key={index} className={user.type === 'admin' ? \"sidebarright-usercontainer\" : \"\"} onClick={this.handleClick} onContextMenu={(event) => { this.contextMenu(event, user); }}>\n                {user.type === 'admin' ? <div className=\"username\">\n                  <img className=\"username-image\" src={user.imageUrl ? user.imageUrl : chatot} alt=\"username-icon\" />\n                </div> : null}\n                {user.type === 'admin' && user.active ? <div className=\"userinfo-online\"></div> : null}\n                {user.type === 'admin' && !user.active ? <div className=\"userinfo-offline\"></div> : null}\n                {user.type === 'admin' ? <span className=\"sidebarright-user\">{user.username}</span> : null}\n              </div>\n            );\n          }) : null}\n          <div className=\"sidebarright-authority\">\n            <span>Moderators</span>\n          </div>\n          <div className=\"sidebarright-bordertwo\" />\n          {this.state.users.length > 0 ? this.state.users.map((user, index)  => {\n            return (\n              <div key={index} className={user.type === 'moderator' ? \"sidebarright-usercontainer\" : \"\"} onClick={this.handleClick} onContextMenu={(event) => { this.contextMenu(event, user); }}>\n                {user.type === 'moderator' ? <div className=\"username\">\n                  <img className=\"username-image\" src={user.imageUrl ? user.imageUrl : chatot} alt=\"username-icon\" />\n                </div> : null}\n                {user.type === 'moderator' && user.active ? <div className=\"userinfo-online\"></div> : null}\n                {user.type === 'moderator' && !user.active ? <div className=\"userinfo-offline\"></div> : null}\n                {user.type === 'moderator' ? <span className=\"sidebarright-user\">{user.username}</span> : null}\n              </div>\n            );\n          }) : null}\n          <div className=\"sidebarright-authority\">\n            <span>Voice</span>\n          </div>\n          <div className=\"sidebarright-bordertwo\" />\n          {this.props.serverUserList.length > 0 ? this.props.serverUserList.map((user, index) => {\n            return (\n              <div key={index} className={user.type === 'voice' ? \"sidebarright-usercontainer\" : \"\"} onClick={this.handleClick} onContextMenu={(event) => { this.contextMenu(event, user); }}>\n                {user.type === 'voice' ? <div className=\"username\">\n                  <img className=\"username-image\" src={user.imageUrl ? user.imageUrl : chatot} alt=\"username-icon\" />\n                </div> : null}\n                {user.type === 'voice' && user.active ? <div className=\"userinfo-online\"></div> : null}\n                {user.type === 'voice' && !user.active ? <div className=\"userinfo-offline\"></div> : null}\n                {user.type === 'voice' ? <span className=\"sidebarright-user\">{user.username}</span> : null}\n              </div>\n            );\n          }) : null}\n          <div className=\"sidebarright-authority\">\n            <span>Users</span>\n          </div>\n          <div className=\"sidebarright-bordertwo\" />\n          {this.props.serverUserList.length > 0 ? this.props.serverUserList.map((user, index) => {\n            return (\n              <div key={index} className={user.type === 'user' ? \"sidebarright-usercontainer\" : \"\"} onClick={this.handleClick} onContextMenu={(event) => { this.contextMenu(event, user); }}>\n                {user.type === 'user' ? <div className=\"username\">\n                  <img className=\"username-image\" src={user.imageUrl ? user.imageUrl : chatot} alt=\"username-icon\" />\n                </div> : null}\n                {user.type === 'user' && user.active ? <div className=\"userinfo-online\"></div> : null}\n                {user.type === 'user' && !user.active ? <div className=\"userinfo-offline\"></div> : null}\n                {user.type === 'user' ? <span className=\"sidebarright-user\">{user.username}</span> : null}\n              </div>\n            )\n          }) : null}\n        </div>\n        {this.state.userModalOpen ?\n          <UserModal\n            userId={this.state.rightClickedUser.userId}\n            username={this.state.rightClickedUser.username}\n            setUserModalOpen={() => { this.setState({ userModalOpen: false }); }}\n            setPrivateMessageUser={() => { this.privateMessageUser(); }}\n          />\n        : null}\n      </div>\n    );\n  }\n}\n\nfunction mapStateToProps({ usersReducer }) {\n  return {\n    error: usersReducer.error,\n    isLoading: usersReducer.isLoading,\n    success: usersReducer.success,\n    user: usersReducer.user,\n    users: usersReducer.users\n  };\n}\n\nexport default connect(mapStateToProps, actions)(Chatroom);"]},"metadata":{},"sourceType":"module"}