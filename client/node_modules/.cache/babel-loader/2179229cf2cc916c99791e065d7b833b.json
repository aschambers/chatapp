{"ast":null,"code":"var _jsxFileName = \"/Users/metabou/Desktop/chatapp/client/src/components/ChatroomFriend/ChatroomFriend.js\";\nimport React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport * as actions from '../../redux';\nimport { ROOT_URL } from '../../config/networkSettings';\nimport io from \"socket.io-client\";\nimport Moment from 'react-moment';\nimport 'moment-timezone';\nimport './ChatroomFriend.css';\nimport numbersign from '../../assets/images/numbersign.png';\n\nclass ChatroomFriend extends Component {\n  constructor(props) {\n    super(props);\n\n    this.sendMessage = event => {\n      if (event) {\n        event.preventDefault();\n        this.socket.emit('CHATROOM_MESSAGE', {\n          username: this.props.username,\n          message: this.state.message,\n          userId: this.props.userId,\n          chatroomId: this.props.activeChatroomId\n        });\n        this.setState({\n          message: \"\"\n        });\n      }\n    };\n\n    this.state = {\n      id: \"\",\n      username: \"\",\n      active: false,\n      type: \"\",\n      imageUrl: \"\",\n      message: \"\",\n      messages: [],\n      userDetails: false,\n      socketId: \"\",\n      currentSocket: \"\"\n    };\n  }\n\n  async componentDidMount() {\n    this.props.currentUser();\n    this.props.getUsers();\n    this.socket = io(ROOT_URL);\n    this.socket.on('connect', () => {\n      this.setState({\n        socketId: this.socket.id\n      });\n    });\n    this.socket.emit('GET_CHATROOM_MESSAGES', {\n      chatroomId: this.props.activeChatroomId\n    });\n    this.socket.on('RECEIVE_CHATROOM_MESSAGE', data => {\n      // scroll to latest message after rendering messages in firefox\n      if (navigator.userAgent.search(\"Firefox\") > -1) {\n        this.setState({\n          messages: data.reverse()\n        }, () => {\n          if (data && data.length > 0) {\n            const element = \"message\" + (this.state.messages.length - 1);\n\n            if (document.getElementById(element)) {\n              document.getElementById(element).scrollIntoView();\n            }\n          }\n        });\n      } else if (navigator.userAgent.search(\"Firefox\") < 0) {\n        this.setState({\n          messages: data\n        });\n      }\n    });\n  }\n\n  async componentWillReceiveProps(nextProps) {\n    if (nextProps.activeChatroomId) {\n      this.socket.emit('GET_CHATROOM_MESSAGES', {\n        chatroomId: nextProps.activeChatroomId\n      });\n    }\n\n    if (nextProps.user) {\n      const _nextProps$user = nextProps.user,\n            id = _nextProps$user.id,\n            username = _nextProps$user.username,\n            active = _nextProps$user.active,\n            type = _nextProps$user.type;\n      this.setState({\n        id: id,\n        username: username,\n        active: active,\n        type: type\n      });\n    }\n\n    if (nextProps.users && nextProps.users.length) {\n      const userList = [];\n\n      for (let i = 0; i < nextProps.users.length; i++) {\n        userList.push(nextProps.users[i]);\n      }\n\n      this.setState({\n        users: userList\n      });\n    }\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      className: \"chatroom\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 100\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"chatarea\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 101\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      id: \"chatareamessages\",\n      className: \"chatarea-messages\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 102\n      },\n      __self: this\n    }, this.state.messages && this.state.messages.length > 0 ? this.state.messages.map((item, index) => {\n      return React.createElement(\"div\", {\n        id: \"message\" + index,\n        key: index,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 105\n        },\n        __self: this\n      }, React.createElement(\"p\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 106\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        className: \"chatarea-messages-user\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 106\n        },\n        __self: this\n      }, item.username), \" \", React.createElement(Moment, {\n        format: \"MM/DD/YYYY\",\n        className: \"chatarea-messages-time\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 106\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 106\n        },\n        __self: this\n      }, item.createdAt))), React.createElement(\"p\", {\n        className: \"chatarea-messages-message\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 107\n        },\n        __self: this\n      }, item.message));\n    }) : null), React.createElement(\"div\", {\n      className: \"chatarea-container\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 112\n      },\n      __self: this\n    }, React.createElement(\"input\", {\n      placeholder: \"Send a message!\",\n      type: \"text\",\n      onChange: event => {\n        this.setState({\n          message: event.target.value\n        });\n      },\n      value: this.state.message,\n      onKeyDown: event => {\n        event.keyCode === 13 && event.shiftKey === false ? this.sendMessage(event) : this.sendMessage(null);\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 113\n      },\n      __self: this\n    }))));\n  }\n\n}\n\nfunction mapStateToProps({\n  usersReducer\n}) {\n  return {\n    error: usersReducer.error,\n    isLoading: usersReducer.isLoading,\n    success: usersReducer.success,\n    user: usersReducer.user,\n    users: usersReducer.users\n  };\n}\n\nexport default connect(mapStateToProps, actions)(ChatroomFriend);","map":{"version":3,"sources":["/Users/metabou/Desktop/chatapp/client/src/components/ChatroomFriend/ChatroomFriend.js"],"names":["React","Component","connect","actions","ROOT_URL","io","Moment","numbersign","ChatroomFriend","constructor","props","sendMessage","event","preventDefault","socket","emit","username","message","state","userId","chatroomId","activeChatroomId","setState","id","active","type","imageUrl","messages","userDetails","socketId","currentSocket","componentDidMount","currentUser","getUsers","on","data","navigator","userAgent","search","reverse","length","element","document","getElementById","scrollIntoView","componentWillReceiveProps","nextProps","user","users","userList","i","push","render","map","item","index","createdAt","target","value","keyCode","shiftKey","mapStateToProps","usersReducer","error","isLoading","success"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport * as actions from '../../redux';\nimport { ROOT_URL } from '../../config/networkSettings';\nimport io from \"socket.io-client\";\nimport Moment from 'react-moment';\nimport 'moment-timezone';\nimport './ChatroomFriend.css';\nimport numbersign from '../../assets/images/numbersign.png';\n\nclass ChatroomFriend extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      id: \"\",\n      username: \"\",\n      active: false,\n      type: \"\",\n      imageUrl: \"\",\n      message: \"\",\n      messages: [],\n      userDetails: false,\n      socketId: \"\",\n      currentSocket: \"\",\n    }\n  }\n\n  async componentDidMount() {\n    this.props.currentUser();\n    this.props.getUsers();\n\n    this.socket = io(ROOT_URL);\n\n    this.socket.on('connect', () => {\n      this.setState({ socketId: this.socket.id });\n    });\n\n    this.socket.emit('GET_CHATROOM_MESSAGES', {\n      chatroomId: this.props.activeChatroomId\n    });\n\n    this.socket.on('RECEIVE_CHATROOM_MESSAGE', (data) => {\n      // scroll to latest message after rendering messages in firefox\n      if (navigator.userAgent.search(\"Firefox\") > -1) {\n        this.setState({ messages: data.reverse() }, () => {\n          if (data && data.length > 0) {\n            const element = \"message\" + (this.state.messages.length - 1);\n            if (document.getElementById(element)) {\n              document.getElementById(element).scrollIntoView();\n            }\n          }\n        });\n      } else if (navigator.userAgent.search(\"Firefox\") < 0) {\n        this.setState({ messages: data });\n      }\n    });\n  }\n\n  async componentWillReceiveProps(nextProps) {\n    if (nextProps.activeChatroomId) {\n      this.socket.emit('GET_CHATROOM_MESSAGES', {\n        chatroomId: nextProps.activeChatroomId\n      });\n    }\n    if (nextProps.user) {\n      const { id, username, active, type } = nextProps.user;\n      this.setState({\n        id: id,\n        username: username,\n        active: active,\n        type: type\n      });\n    }\n\n    if (nextProps.users && nextProps.users.length) {\n      const userList = [];\n      for(let i = 0; i < nextProps.users.length; i++) {\n        userList.push(nextProps.users[i]);\n      }\n      this.setState({ users: userList });\n    }\n  }\n\n  sendMessage = (event) => {\n    if (event) {\n      event.preventDefault();\n      this.socket.emit('CHATROOM_MESSAGE', {\n        username: this.props.username,\n        message: this.state.message,\n        userId: this.props.userId,\n        chatroomId: this.props.activeChatroomId\n      });\n      this.setState({ message: \"\" });\n    }\n  }\n\n  render() {\n    return (\n      <div className=\"chatroom\">\n        <div className=\"chatarea\">\n          <div id=\"chatareamessages\" className=\"chatarea-messages\">\n            {this.state.messages && this.state.messages.length > 0 ? this.state.messages.map((item, index) => {\n              return (\n                <div id={\"message\" + index} key={index}>\n                  <p><span className=\"chatarea-messages-user\">{item.username}</span> <Moment format=\"MM/DD/YYYY\" className=\"chatarea-messages-time\"><span>{item.createdAt}</span></Moment></p>\n                  <p className=\"chatarea-messages-message\">{item.message}</p>\n                </div>\n              )\n            }) : null}\n          </div>\n          <div className=\"chatarea-container\">\n            <input placeholder=\"Send a message!\" type=\"text\" onChange={(event) => { this.setState({ message: event.target.value }); }} value={this.state.message} onKeyDown={(event) => { event.keyCode === 13 && event.shiftKey === false ? this.sendMessage(event) : this.sendMessage(null) }}></input>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nfunction mapStateToProps({ usersReducer }) {\n  return {\n    error: usersReducer.error,\n    isLoading: usersReducer.isLoading,\n    success: usersReducer.success,\n    user: usersReducer.user,\n    users: usersReducer.users\n  };\n}\n\nexport default connect(mapStateToProps, actions)(ChatroomFriend);"]},"metadata":{},"sourceType":"module"}