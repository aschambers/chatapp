{"ast":null,"code":"var _jsxFileName = \"/Users/metabou/Desktop/chatapp/client/src/components/Chatroom/Chatroom.js\";\nimport React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport * as actions from '../../redux';\nimport { ROOT_URL } from '../../config/networkSettings';\nimport io from 'socket.io-client';\nimport Moment from 'react-moment';\nimport 'moment-timezone';\nimport './Chatroom.css';\nimport chatot from '../../assets/images/chatot.png';\nimport numbersign from '../../assets/images/numbersign.png';\nimport voice from '../../assets/images/voice.png';\nimport editwhite from '../../assets/images/editwhite.png';\nimport paperclip from '../../assets/images/paperclip.png';\nimport emoji from '../../assets/images/emoji.png';\nimport EmojiPicker from 'emoji-picker-react';\n\nclass Chatroom extends Component {\n  constructor(props) {\n    super(props);\n\n    this.useOnClickOutside = (ref, handler) => {\n      const listener = event => {\n        // Do nothing if clicking ref's element or descendent elements\n        if (!ref.current || ref.current.contains(event.target)) {\n          return;\n        }\n\n        handler(event);\n      };\n\n      document.addEventListener('mousedown', listener);\n      document.addEventListener('touchstart', listener);\n      return () => {\n        document.removeEventListener('mousedown', listener);\n        document.removeEventListener('touchstart', listener);\n      };\n    };\n\n    this.recordAudioInput = async stream => {\n      if (stream) {\n        try {\n          console.log('------ my stream -------');\n          console.log(stream);\n          console.log('------ end my stream -------');\n          const audioElements = document.getElementById('audioElements');\n          const remoteAudio = document.createElement('audio');\n          remoteAudio.style.display = \"none\";\n          remoteAudio.srcObject = stream;\n          remoteAudio.autoplay = true;\n          audioElements.appendChild(remoteAudio);\n          const STUN = {\n            urls: 'stun:stun.l.google.com:19302'\n          };\n          const TURN = {\n            urls: 'turn:turn.bistri.com:80',\n            credential: 'homeo',\n            username: 'homeo'\n          };\n          const configuration = {\n            iceServers: [STUN, TURN]\n          };\n          await this.setState({\n            myConnection: new RTCPeerConnection(configuration)\n          });\n          await stream.getTracks().forEach(track => {\n            this.state.myConnection.addTrack(track, stream);\n          });\n\n          this.state.myConnection.onicecandidate = event => {\n            const candidateQueue = [];\n\n            if (this.state.myConnection.remoteDescription) {\n              if (event.candidate && event.candidate.sdpMid !== \"0\") {\n                this.socket.emit('SEND_ICE_CANDIDATE', {\n                  candidate: event.candidate,\n                  room: this.state.room\n                });\n              }\n\n              if (candidateQueue && candidateQueue.length < 1) return;\n\n              for (let i = 0; i < candidateQueue.length; i++) {\n                this.socket.emit('SEND_ICE_CANDIDATE', {\n                  candidate: event.candidate,\n                  room: this.state.room\n                });\n              }\n            } else if (!this.state.myConnection.remoteDescription && event.candidate && event.candidate.sdpMid !== \"0\") {\n              candidateQueue.push(event.candidate);\n            }\n          };\n\n          this.state.myConnection.ontrack = event => {\n            console.log(event.streams[0]);\n            if (!event.streams[0]) return;\n            const audioElements = document.getElementById('audioElements');\n            const remoteAudio = document.createElement('audio');\n            remoteAudio.style.display = \"none\";\n            remoteAudio.srcObject = event.streams[0];\n            remoteAudio.autoplay = true;\n            audioElements.appendChild(remoteAudio);\n          };\n        } catch (error) {\n          console.log('error setting up RTCPeerConnection: ' + error);\n        }\n      } else {\n        const audioElements = document.getElementById('audioElements');\n        audioElements.innerHTML = '';\n      }\n    };\n\n    this.startCall = () => {\n      if (!this.state.myConnection) return;\n      this.createCallerOffer();\n    };\n\n    this.createCallerOffer = async () => {\n      console.log(\"--- negotiating in \".concat(this.state.myConnection.signalingState, \" ---\"));\n\n      try {\n        const desc = await this.state.myConnection.createOffer({\n          offerToReceiveAudio: 1,\n          offerToReceiveVideo: 0\n        });\n        this.setCallerLocalDescription(desc);\n      } catch (error) {\n        console.log('error creating caller offer: ' + error);\n      }\n    };\n\n    this.setCallerLocalDescription = async desc => {\n      try {\n        await this.state.myConnection.setLocalDescription(desc);\n        console.log('-- start myConnection after setLocalDescription --');\n        console.log(this.state.myConnection);\n        console.log('-- end myConnection after setLocalDescription --');\n        this.sendOfferFromCaller(desc);\n      } catch (error) {\n        console.log('error setting caller local description: ' + error);\n      }\n    };\n\n    this.sendOfferFromCaller = desc => {\n      console.log('-- sendOfferFromCaller --');\n      const data = {\n        desc: desc,\n        username: this.state.username,\n        room: this.state.room\n      };\n      this.socket.emit('SEND_OFFER', data);\n    };\n\n    this.setCalleeRemoteDescription = async desc => {\n      console.log('-- setCalleeRemoteDescription --');\n\n      try {\n        await this.state.myConnection.setRemoteDescription(desc);\n        this.calleCreateAnswer();\n      } catch (error) {\n        console.log('error setting callee remote description: ' + error);\n      }\n    };\n\n    this.calleCreateAnswer = async () => {\n      console.log('-- calleeCreateAnswer --');\n\n      try {\n        const desc = await this.state.myConnection.createAnswer();\n        this.setCalleeLocalDescription(desc);\n      } catch (error) {\n        console.log('error creating callee answer: ' + error);\n      }\n    };\n\n    this.setCalleeLocalDescription = async desc => {\n      console.log('-- setCalleeLocalDescription --');\n\n      try {\n        await this.state.myConnection.setLocalDescription(desc);\n        this.sendCallerDescription(desc);\n      } catch (error) {\n        console.log('error setting callee local description: ' + error);\n      }\n    };\n\n    this.sendCallerDescription = desc => {\n      console.log('-- sendCallerDescription --');\n      const data = {\n        desc: desc,\n        username: this.state.username,\n        room: this.state.room\n      };\n      this.socket.emit('SEND_ANSWER', data);\n    };\n\n    this.setCallerRemoteDescription = async desc => {\n      console.log('-- setCallerRemoteDescription --');\n\n      try {\n        await this.state.myConnection.setRemoteDescription(desc);\n      } catch (error) {\n        console.log('error setting caller remote description: ' + error);\n      }\n    };\n\n    this.sideContextMenu = (event, item) => {\n      event.preventDefault();\n      this.setState({\n        sideRightClickedUser: item,\n        sideUserModalOpen: true\n      });\n    };\n\n    this.contextMenu = (event, item) => {\n      event.preventDefault();\n      this.setState({\n        rightClickedUser: item,\n        userModalOpen: true,\n        messageMenu: false,\n        editingMessage: null\n      });\n    };\n\n    this.privateMessageUser = () => {\n      this.setState({\n        messages: []\n      });\n      this.props.privateMessageUser(this.state.rightClickedUser);\n    };\n\n    this.sidePrivateMessageUser = () => {\n      this.setState({\n        messages: []\n      });\n      this.props.privateMessageUser(this.state.sideRightClickedUser);\n    };\n\n    this.openMessageMenu = item => {\n      this.setState({\n        messageMenu: true,\n        editMessage: item\n      });\n    };\n\n    this.deleteChatroomMessage = () => {\n      const data = {\n        username: this.props.username,\n        message: this.state.message,\n        userId: this.props.userId,\n        chatroomId: this.state.chatroomId,\n        messageId: this.state.editMessage.id,\n        room: this.state.room\n      };\n      this.socket.emit('DELETE_CHATROOM_MESSAGE', data);\n    };\n\n    this.editChatroomMessage = () => {\n      this.setState({\n        editingMessage: this.state.editMessage,\n        newMessage: this.state.editMessage.message,\n        hover: \"\"\n      }, () => {\n        this.setState({\n          editMessage: null,\n          messageMenu: false\n        });\n      });\n    };\n\n    this.detectEscape = event => {\n      if (event.keyCode === 27 && !this.state.messageMenu) {\n        this.setState({\n          editingMessage: this.state.editMessage,\n          newMessage: \"\"\n        });\n      }\n    };\n\n    this.sendEditedMessage = event => {\n      event.preventDefault();\n      const data = {\n        username: this.props.username,\n        message: this.state.newMessage,\n        userId: this.props.userId,\n        chatroomId: this.state.chatroomId,\n        messageId: this.state.editingMessage.id,\n        room: this.state.room\n      };\n      this.socket.emit('EDIT_CHATROOM_MESSAGE', data);\n    };\n\n    this.kickUser = user => {\n      const data = {\n        serverId: this.state.serverId,\n        chatroomId: this.state.chatroomId,\n        type: 'user',\n        userId: user.userId,\n        room: this.state.room\n      };\n      this.socket.emit('KICK_SERVER_USER', data);\n    };\n\n    this.banUser = user => {\n      const data = {\n        serverId: this.state.serverId,\n        chatroomId: this.state.chatroomId,\n        type: 'user',\n        userId: user.userId,\n        room: this.state.room\n      };\n      this.socket.emit('BAN_SERVER_USER', data);\n    };\n\n    this.sendMessage = event => {\n      if (event && this.state.message !== \"\") {\n        event.preventDefault();\n        const data = {\n          username: this.props.username,\n          message: this.state.message,\n          userId: this.props.userId,\n          chatroomId: this.state.chatroomId,\n          room: this.state.room\n        };\n        this.socket.emit('CHATROOM_MESSAGE', data);\n        this.setState({\n          message: \"\"\n        });\n      }\n    };\n\n    this.showEmojiPicker = () => {\n      let showEmojiPicker = this.state.showEmojiPicker;\n      this.setState({\n        showEmojiPicker: !showEmojiPicker\n      });\n    };\n\n    this.handleEmojiClick = code => {\n      this.setState({\n        message: this.state.message + String.fromCodePoint(\"0x\" + code)\n      });\n    };\n\n    this.handleMessageChange = event => {\n      if (event.target.value.length < 500) {\n        this.setState({\n          message: event.target.value\n        });\n      }\n    };\n\n    this.handleNewMessageChange = event => {\n      if (event.target.value.length < 500) {\n        this.setState({\n          newMessage: event.target.value\n        });\n      }\n    };\n\n    this.clickMainFile = () => {\n      console.log('clicked');\n      console.log(this.mainFile);\n      this.mainFile.current.click();\n    };\n\n    this.showMainFile = event => {\n      console.log('attachment open');\n      event.preventDefault();\n      let reader = new FileReader();\n      let file = event.target.files[0]; // console.log(file);\n\n      reader.onloadend = () => {\n        console.log(file);\n        console.log(reader.result); // setMainFile(file);\n        // setEditImageUrl(reader.result);\n      };\n\n      reader.readAsText(file);\n    };\n\n    this.ref = React.createRef();\n    this.useOnClickOutside(this.ref, () => this.setState({\n      messageMenu: false,\n      userModalOpen: false,\n      sideUserModalOpen: false,\n      showEmojiPicker: false\n    })); // file upload\n\n    this.mainSubmit = React.createRef();\n    this.mainFile = React.createRef();\n    this.state = {\n      id: \"\",\n      username: \"\",\n      active: false,\n      type: \"\",\n      imageUrl: \"\",\n      message: \"\",\n      messages: [],\n      users: [],\n      clickedUsername: \"\",\n      clickedType: \"\",\n      privateMessages: [],\n      personalMessages: [],\n      userDetails: false,\n      socketId: \"\",\n      currentSocket: \"\",\n      rightClickedUser: {},\n      sideRightClickedUser: {},\n      sideUserModalOpen: false,\n      userModalOpen: false,\n      namespace: null,\n      room: null,\n      serverId: null,\n      previousRoom: null,\n      currentChatroom: null,\n      editMessage: null,\n      messageMenu: false,\n      editingMessage: null,\n      newMessage: \"\",\n      hover: \"\",\n      serverUserList: [],\n      isLoading: false,\n      chunks: [],\n      myConnection: null,\n      remoteConnection: null,\n      voiceUsers: [],\n      negotiating: false,\n      showEmojiPicker: false\n    };\n  }\n\n  async componentDidMount() {\n    window.addEventListener('keydown', this.detectEscape);\n    this.socket = io(ROOT_URL);\n    this.socket.on('connect', () => {\n      this.setState({\n        serverUserList: this.props.serverUserList,\n        socketId: this.socket.id,\n        namespace: \"\".concat(ROOT_URL, \"/\").concat(this.props.serverId),\n        room: \"\".concat(ROOT_URL, \"/chatroom/\").concat(this.props.serverId, \"/\").concat(this.props.activeChatroomId),\n        previousRoom: \"\".concat(ROOT_URL, \"/chatroom/\").concat(this.props.serverId, \"/\").concat(this.props.activeChatroomId),\n        serverId: this.props.serverId,\n        currentChatroom: this.props.activeChatroom,\n        chatroomId: this.props.activeChatroomId,\n        username: this.props.username\n      });\n      this.socket.emit('GET_CHATROOM_MESSAGES', {\n        socketId: this.socket.id,\n        chatroomId: this.props.activeChatroomId,\n        previousRoom: \"\".concat(ROOT_URL, \"/chatroom/\").concat(this.props.serverId, \"/\").concat(this.props.activeChatroomId),\n        room: \"\".concat(ROOT_URL, \"/chatroom/\").concat(this.props.serverId, \"/\").concat(this.props.activeChatroomId)\n      });\n    });\n    this.socket.on('RECEIVE_CHATROOM_MESSAGES', data => {\n      this.setState({\n        messageMenu: false,\n        editMessage: null,\n        editingMessage: null,\n        newMessage: \"\"\n      }); // scroll to latest message after rendering messages in firefox\n\n      if (navigator.userAgent.search(\"Firefox\") > -1 || navigator.userAgent.search(\"Edge\") > -1) {\n        this.setState({\n          messages: data.reverse()\n        }, () => {\n          if (data && data.length > 0) {\n            const element = \"message\" + (this.state.messages.length - 1);\n\n            if (document.getElementById(element)) {\n              document.getElementById(element).scrollIntoView();\n            }\n          }\n        });\n      } else if (navigator.userAgent.search(\"Firefox\") < 0 || navigator.userAgent.search(\"Edge\") < 0) {\n        this.setState({\n          messages: data\n        });\n      }\n    });\n    this.socket.on('RECEIVE_SERVER_LIST', data => {\n      const index = data.findIndex(x => x.username === this.state.username);\n\n      if (index < 0) {\n        this.props.leaveServer();\n      } else if (index > -1) {\n        this.props.refreshServerUsers();\n        this.setState({\n          userModalOpen: false,\n          sideUserModalOpen: false,\n          rightClickedUser: {},\n          sideRightClickedUser: {},\n          serverUserList: data\n        });\n      }\n    }); // -- begin webrtc socket events -- //\n\n    this.socket.on('RECEIVE_ICE_CANDIDATE', async data => {\n      console.log('-- start receive ice candidate --');\n      console.log(data.candidate);\n      console.log('-- end receive ice candidate --');\n      await this.state.myConnection.addIceCandidate(new RTCIceCandidate(data.candidate)).catch(err => console.log(err));\n    });\n    this.socket.on('RECEIVE_OFFER', async data => {\n      console.log(data.username + ' =?= ' + this.state.username);\n      this.setCalleeRemoteDescription(data.desc);\n    });\n    this.socket.on('RECEIVE_ANSWER', async data => {\n      console.log(data.username + ' =?= ' + this.state.username);\n      this.setCallerRemoteDescription(data.desc);\n    }); // -- end webrtc socket events -- //\n  }\n\n  async componentWillReceiveProps(nextProps) {\n    if (nextProps.username) {\n      this.setState({\n        username: nextProps.username\n      });\n    }\n\n    if (nextProps.serverUserList) {\n      this.setState({\n        serverUserList: nextProps.serverUserList\n      });\n    }\n\n    if (nextProps.activeChatroomId !== this.state.chatroomId && this.state.chatroomId !== undefined) {\n      await this.setState({\n        previousRoom: \"\".concat(ROOT_URL, \"/chatroom/\").concat(nextProps.serverId, \"/\").concat(this.state.chatroomId),\n        room: \"\".concat(ROOT_URL, \"/chatroom/\").concat(nextProps.serverId, \"/\").concat(nextProps.activeChatroomId),\n        serverId: nextProps.serverId,\n        currentChatroom: nextProps.activeChatroom,\n        chatroomId: nextProps.activeChatroomId\n      });\n      this.socket.emit('GET_CHATROOM_MESSAGES', {\n        socketId: this.state.socketId,\n        chatroomId: nextProps.activeChatroomId,\n        previousRoom: \"\".concat(ROOT_URL, \"/chatroom/\").concat(nextProps.serverId, \"/\").concat(this.state.chatroomId),\n        room: \"\".concat(ROOT_URL, \"/chatroom/\").concat(nextProps.serverId, \"/\").concat(nextProps.activeChatroomId)\n      });\n    }\n\n    if (nextProps.users && nextProps.users.length) {\n      const userList = [];\n\n      for (let i = 0; i < nextProps.users.length; i++) {\n        userList.push(nextProps.users[i]);\n      }\n\n      this.setState({\n        users: userList\n      });\n    } // -- start webrtc audio setup -- //\n\n\n    if (nextProps.activeChatroomType === \"voice\" && nextProps.audioStream) {\n      await this.setState({\n        localStream: nextProps.audioStream\n      });\n      this.recordAudioInput(nextProps.audioStream);\n    }\n\n    if (nextProps.activeChatroomType !== \"voice\") {\n      await this.setState({\n        localStream: null\n      });\n      this.recordAudioInput(null);\n    } // -- end webrtc audio setup -- //\n\n  } // -- start webrtc peer connection setup -- //\n\n\n  componentWillUnmount() {\n    this.socket.emit('LEAVE_CHATROOMS', {\n      room: this.state.room\n    });\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      className: \"chatroom\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 517\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      id: \"audioElements\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 518\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      className: \"chatarea\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 519\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"chatarea-topbar\",\n      onClick: () => {\n        this.startCall();\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 520\n      },\n      __self: this\n    }, React.createElement(\"img\", {\n      src: this.props.activeChatroomType === \"text\" ? numbersign : voice,\n      alt: \"channel\",\n      height: 16,\n      width: 16,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 521\n      },\n      __self: this\n    }), React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 521\n      },\n      __self: this\n    }, this.props.activeChatroom)), React.createElement(\"div\", {\n      id: \"chatareamessages\",\n      className: \"chatarea-messages\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 523\n      },\n      __self: this\n    }, this.state.messages && this.state.messages.length > 0 ? this.state.messages.map((item, index) => {\n      const moderate = this.state.serverUserList.length > 0 && this.state.serverUserList.some(serverItem => serverItem['username'] !== this.state.username && serverItem['username'] === item.username && serverItem['type'] !== 'owner' && serverItem['type'] !== 'admin');\n      return React.createElement(\"div\", {\n        id: \"message\" + index,\n        key: index,\n        onMouseEnter: () => {\n          this.setState({\n            hover: this.state.editingMessage || this.state.messageMenu || this.props.userId !== item.userId ? \"\" : \"message\" + index\n          });\n        },\n        onMouseLeave: () => {\n          this.setState({\n            hover: \"\"\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 529\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"chatarea-messages-container\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 530\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        className: \"chatarea-messages-user\",\n        onClick: this.handleClick,\n        onContextMenu: event => {\n          this.contextMenu(event, item);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 531\n        },\n        __self: this\n      }, item.username), React.createElement(Moment, {\n        format: \"MM/DD/YYYY\",\n        date: item.updatedAt,\n        className: \"chatarea-messages-time\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 532\n        },\n        __self: this\n      }), this.state.hover === \"message\" + index ? React.createElement(\"span\", {\n        className: \"chatarea-messages-menu\",\n        onClick: () => {\n          this.openMessageMenu(item);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 533\n        },\n        __self: this\n      }, React.createElement(\"img\", {\n        src: editwhite,\n        height: 15,\n        width: 15,\n        alt: \"edit message\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 533\n        },\n        __self: this\n      })) : null, this.state.messageMenu && this.state.editMessage.id === item.id ? React.createElement(\"div\", {\n        className: \"chatarea-messages-editmenu\",\n        ref: this.ref,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 535\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        onClick: () => {\n          this.setState({\n            editMessage: null,\n            messageMenu: false\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 536\n        },\n        __self: this\n      }, \"\\u2715\"), React.createElement(\"p\", {\n        onClick: () => {\n          this.editChatroomMessage();\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 537\n        },\n        __self: this\n      }, \"Edit\"), React.createElement(\"p\", {\n        onClick: () => {\n          this.deleteChatroomMessage();\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 538\n        },\n        __self: this\n      }, \"Delete\")) : null, this.state.userModalOpen && this.state.rightClickedUser.id === item.id ? React.createElement(\"div\", {\n        ref: this.ref,\n        className: moderate === true ? \"chatarea-messages-usermodalmod\" : \"chatarea-messages-usermodal\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 542\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        onClick: () => {\n          this.setState({\n            userModalOpen: false\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 543\n        },\n        __self: this\n      }, \"\\u2715\"), React.createElement(\"p\", {\n        onClick: () => {\n          this.privateMessageUser();\n        },\n        className: moderate === true ? \"chatarea-messages-usermodalmod-privatemessage\" : \"chatarea-messages-usermodal-privatemessage\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 544\n        },\n        __self: this\n      }, \"Send Message\"), moderate === true ? React.createElement(\"p\", {\n        onClick: () => {\n          this.kickUser(item);\n        },\n        className: \"chatarea-messages-usermodalmod-kick\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 546\n        },\n        __self: this\n      }, \"Kick \", item.username) : null, moderate === true ? React.createElement(\"p\", {\n        onClick: () => {\n          this.banUser(item);\n        },\n        className: \"chatarea-messages-usermodalmod-ban\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 548\n        },\n        __self: this\n      }, \"Ban \", item.username) : null) : null), this.state.editingMessage !== null && this.state.editingMessage.id === item.id ? React.createElement(\"span\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 552\n        },\n        __self: this\n      }, React.createElement(\"input\", {\n        className: \"chatarea-messages-editmessage\",\n        onChange: event => {\n          this.handleNewMessageChange(event);\n        },\n        value: this.state.newMessage,\n        onKeyDown: event => {\n          event.keyCode === 13 && event.shiftKey === false ? this.sendEditedMessage(event) : this.sendMessage(null);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 552\n        },\n        __self: this\n      }), React.createElement(\"p\", {\n        className: \"chatarea-messages-editmessage-note\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 552\n        },\n        __self: this\n      }, \"escape to cancel \\u2022 enter to save\")) : React.createElement(\"p\", {\n        className: \"chatarea-messages-message\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 552\n        },\n        __self: this\n      }, item.message));\n    }) : null), this.state.showEmojiPicker ? React.createElement(\"div\", {\n      className: \"emojipickerchatroom\",\n      ref: this.ref,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 558\n      },\n      __self: this\n    }, React.createElement(EmojiPicker, {\n      style: {\n        width: \"-webkit-fill-available\"\n      },\n      emojiResolution: 32,\n      onEmojiClick: this.handleEmojiClick,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 559\n      },\n      __self: this\n    })) : null, React.createElement(\"div\", {\n      className: \"chatarea-container\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 566\n      },\n      __self: this\n    }, React.createElement(\"input\", {\n      id: \"file\",\n      type: \"file\",\n      style: {\n        display: 'none'\n      },\n      ref: this.mainFile,\n      onChange: event => {\n        this.showMainFile(event);\n      },\n      accept: \".txt\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 567\n      },\n      __self: this\n    }), React.createElement(\"img\", {\n      src: paperclip,\n      alt: \"paperclip-icon\",\n      className: \"attach\",\n      ref: this.mainSubmit,\n      onClick: this.clickMainFile,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 568\n      },\n      __self: this\n    }), React.createElement(\"input\", {\n      placeholder: \"Send a message!\",\n      type: \"text\",\n      onChange: event => {\n        this.handleMessageChange(event);\n      },\n      value: this.state.message,\n      onKeyDown: event => {\n        event.keyCode === 13 && event.shiftKey === false ? this.sendMessage(event) : this.sendMessage(null);\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 569\n      },\n      __self: this\n    }), React.createElement(\"img\", {\n      src: emoji,\n      className: \"emojiselectchatroom\",\n      onClick: () => {\n        this.showEmojiPicker();\n      },\n      alt: \"emoji-picker-icon\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 570\n      },\n      __self: this\n    }))), React.createElement(\"div\", {\n      className: \"sidebarright\",\n      onClick: () => {\n        this.hideEmojiPicker();\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 573\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"sidebarright-container\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 574\n      },\n      __self: this\n    }, React.createElement(\"input\", {\n      placeholder: \"Filter users in server\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 575\n      },\n      __self: this\n    })), React.createElement(\"div\", {\n      className: \"sidebarright-border\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 577\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      className: \"sidebarright-authority\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 578\n      },\n      __self: this\n    }, React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 579\n      },\n      __self: this\n    }, \"Room Owners\")), React.createElement(\"div\", {\n      className: \"sidebarright-bordertwo\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 581\n      },\n      __self: this\n    }), this.state.serverUserList.length > 0 ? this.state.serverUserList.map((user, index) => {\n      return React.createElement(\"div\", {\n        key: index,\n        className: user.type === 'owner' ? \"sidebarright-usercontainer\" : \"\",\n        onClick: this.handleClick,\n        onContextMenu: event => {\n          this.sideContextMenu(event, user);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 584\n        },\n        __self: this\n      }, user.type === 'owner' ? React.createElement(\"div\", {\n        className: \"username\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 585\n        },\n        __self: this\n      }, React.createElement(\"img\", {\n        className: \"username-image\",\n        src: user.imageUrl ? user.imageUrl : chatot,\n        alt: \"username-icon\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 586\n        },\n        __self: this\n      })) : null, user.type === 'owner' && user.active ? React.createElement(\"div\", {\n        className: \"userinfo-online\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 588\n        },\n        __self: this\n      }) : null, user.type === 'owner' && !user.active ? React.createElement(\"div\", {\n        className: \"userinfo-offline\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 589\n        },\n        __self: this\n      }) : null, user.type === 'owner' ? React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 591\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        className: \"sidebarright-user\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 592\n        },\n        __self: this\n      }, user.username), this.state.sideUserModalOpen && user.type === 'owner' && this.state.sideRightClickedUser.username === user.username ? React.createElement(\"div\", {\n        ref: this.ref,\n        className: \"chatarea-messages-sideusermodal\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 594\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        onClick: () => {\n          this.setState({\n            sideUserModalOpen: false\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 595\n        },\n        __self: this\n      }, \"\\u2715\"), React.createElement(\"p\", {\n        onClick: () => {\n          this.sidePrivateMessageUser();\n        },\n        className: \"chatarea-messages-sideusermodal-privatemessage\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 596\n        },\n        __self: this\n      }, \"Send Message\")) : null) : null);\n    }) : null, this.state.serverUserList.length > 0 && this.state.serverUserList.some(item => item['type'] === 'owner') ? React.createElement(\"div\", {\n      className: \"sidebarright-bordertwo\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 604\n      },\n      __self: this\n    }) : null, React.createElement(\"div\", {\n      className: \"sidebarright-authority\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 605\n      },\n      __self: this\n    }, React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 606\n      },\n      __self: this\n    }, \"Administrators\")), React.createElement(\"div\", {\n      className: \"sidebarright-bordertwo\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 608\n      },\n      __self: this\n    }), this.state.serverUserList.length > 0 ? this.state.serverUserList.map((user, index) => {\n      return React.createElement(\"div\", {\n        key: index,\n        className: user.type === 'admin' ? \"sidebarright-usercontainer\" : \"\",\n        onClick: this.handleClick,\n        onContextMenu: event => {\n          this.sideContextMenu(event, user);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 611\n        },\n        __self: this\n      }, user.type === 'admin' ? React.createElement(\"div\", {\n        className: \"username\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 612\n        },\n        __self: this\n      }, React.createElement(\"img\", {\n        className: \"username-image\",\n        src: user.imageUrl ? user.imageUrl : chatot,\n        alt: \"username-icon\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 613\n        },\n        __self: this\n      })) : null, user.type === 'admin' && user.active ? React.createElement(\"div\", {\n        className: \"userinfo-online\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 615\n        },\n        __self: this\n      }) : null, user.type === 'admin' && !user.active ? React.createElement(\"div\", {\n        className: \"userinfo-offline\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 616\n        },\n        __self: this\n      }) : null, user.type === 'admin' ? React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 618\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        className: \"sidebarright-user\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 619\n        },\n        __self: this\n      }, user.username), this.state.sideUserModalOpen && user.type === 'admin' && this.state.sideRightClickedUser.username === user.username ? React.createElement(\"div\", {\n        ref: this.ref,\n        className: \"chatarea-messages-sideusermodal\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 621\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        onClick: () => {\n          this.setState({\n            sideUserModalOpen: false\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 622\n        },\n        __self: this\n      }, \"\\u2715\"), React.createElement(\"p\", {\n        onClick: () => {\n          this.sidePrivateMessageUser();\n        },\n        className: \"chatarea-messages-sideusermodal-privatemessage\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 623\n        },\n        __self: this\n      }, \"Send Message\")) : null) : null);\n    }) : null, this.state.serverUserList.length > 0 && this.state.serverUserList.some(item => item['type'] === 'admin') ? React.createElement(\"div\", {\n      className: \"sidebarright-bordertwo\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 631\n      },\n      __self: this\n    }) : null, React.createElement(\"div\", {\n      className: \"sidebarright-authority\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 632\n      },\n      __self: this\n    }, React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 633\n      },\n      __self: this\n    }, \"Moderators\")), React.createElement(\"div\", {\n      className: \"sidebarright-bordertwo\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 635\n      },\n      __self: this\n    }), this.state.serverUserList.length > 0 ? this.state.serverUserList.map((user, index) => {\n      const moderate = user.username !== this.state.username;\n      return React.createElement(\"div\", {\n        key: index,\n        className: user.type === 'moderator' ? \"sidebarright-usercontainer\" : \"\",\n        onClick: this.handleClick,\n        onContextMenu: event => {\n          this.sideContextMenu(event, user);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 639\n        },\n        __self: this\n      }, user.type === 'moderator' ? React.createElement(\"div\", {\n        className: \"username\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 640\n        },\n        __self: this\n      }, React.createElement(\"img\", {\n        className: \"username-image\",\n        src: user.imageUrl ? user.imageUrl : chatot,\n        alt: \"username-icon\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 641\n        },\n        __self: this\n      })) : null, user.type === 'moderator' && user.active ? React.createElement(\"div\", {\n        className: \"userinfo-online\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 643\n        },\n        __self: this\n      }) : null, user.type === 'moderator' && !user.active ? React.createElement(\"div\", {\n        className: \"userinfo-offline\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 644\n        },\n        __self: this\n      }) : null, user.type === 'moderator' ? React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 646\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        className: \"sidebarright-user\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 647\n        },\n        __self: this\n      }, user.username), this.state.sideUserModalOpen && user.type === 'moderator' && this.state.sideRightClickedUser.username === user.username ? React.createElement(\"div\", {\n        ref: this.ref,\n        className: moderate === true ? \"chatarea-messages-sideusermodalmod\" : \"chatarea-messages-sideusermodal\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 649\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        onClick: () => {\n          this.setState({\n            sideUserModalOpen: false\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 650\n        },\n        __self: this\n      }, \"\\u2715\"), React.createElement(\"p\", {\n        onClick: () => {\n          this.sidePrivateMessageUser();\n        },\n        className: moderate === true ? \"chatarea-messages-sideusermodalmod-privatemessage\" : \"chatarea-messages-sideusermodal-privatemessage\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 651\n        },\n        __self: this\n      }, \"Send Message\"), moderate === true ? React.createElement(\"p\", {\n        onClick: () => {\n          this.kickUser(user);\n        },\n        className: \"chatarea-messages-sideusermodalmod-kick\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 653\n        },\n        __self: this\n      }, \"Kick \", user.username) : null, moderate === true ? React.createElement(\"p\", {\n        onClick: () => {\n          this.banUser(user);\n        },\n        className: \"chatarea-messages-sideusermodalmod-ban\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 655\n        },\n        __self: this\n      }, \"Ban \", user.username) : null) : null) : null);\n    }) : null, this.state.serverUserList.length > 0 && this.state.serverUserList.some(item => item['type'] === 'moderator') ? React.createElement(\"div\", {\n      className: \"sidebarright-bordertwo\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 663\n      },\n      __self: this\n    }) : null, React.createElement(\"div\", {\n      className: \"sidebarright-authority\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 664\n      },\n      __self: this\n    }, React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 665\n      },\n      __self: this\n    }, \"Voice\")), React.createElement(\"div\", {\n      className: \"sidebarright-bordertwo\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 667\n      },\n      __self: this\n    }), this.state.serverUserList.length > 0 ? this.state.serverUserList.map((user, index) => {\n      const moderate = user.username !== this.state.username;\n      return React.createElement(\"div\", {\n        key: index,\n        className: user.type === 'voice' ? \"sidebarright-usercontainer\" : \"\",\n        onClick: this.handleClick,\n        onContextMenu: event => {\n          this.sideContextMenu(event, user);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 671\n        },\n        __self: this\n      }, user.type === 'voice' ? React.createElement(\"div\", {\n        className: \"username\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 672\n        },\n        __self: this\n      }, React.createElement(\"img\", {\n        className: \"username-image\",\n        src: user.imageUrl ? user.imageUrl : chatot,\n        alt: \"username-icon\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 673\n        },\n        __self: this\n      })) : null, user.type === 'voice' && user.active ? React.createElement(\"div\", {\n        className: \"userinfo-online\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 675\n        },\n        __self: this\n      }) : null, user.type === 'voice' && !user.active ? React.createElement(\"div\", {\n        className: \"userinfo-offline\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 676\n        },\n        __self: this\n      }) : null, user.type === 'voice' ? React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 678\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        className: \"sidebarright-user\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 679\n        },\n        __self: this\n      }, user.username), this.state.sideUserModalOpen && user.type === 'voice' && this.state.sideRightClickedUser.username === user.username ? React.createElement(\"div\", {\n        ref: this.ref,\n        className: moderate === true ? \"chatarea-messages-sideusermodalmod\" : \"chatarea-messages-sideusermodal\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 681\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        onClick: () => {\n          this.setState({\n            sideUserModalOpen: false\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 682\n        },\n        __self: this\n      }, \"\\u2715\"), React.createElement(\"p\", {\n        onClick: () => {\n          this.sidePrivateMessageUser();\n        },\n        className: moderate === true ? \"chatarea-messages-sideusermodalmod-privatemessage\" : \"chatarea-messages-sideusermodal-privatemessage\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 683\n        },\n        __self: this\n      }, \"Send Message\"), moderate === true ? React.createElement(\"p\", {\n        onClick: () => {\n          this.kickUser(user);\n        },\n        className: \"chatarea-messages-sideusermodalmod-kick\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 685\n        },\n        __self: this\n      }, \"Kick \", user.username) : null, moderate === true ? React.createElement(\"p\", {\n        onClick: () => {\n          this.banUser(user);\n        },\n        className: \"chatarea-messages-sideusermodalmod-ban\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 687\n        },\n        __self: this\n      }, \"Ban \", user.username) : null) : null) : null);\n    }) : null, this.state.serverUserList.length > 0 && this.state.serverUserList.some(item => item['type'] === 'voice') ? React.createElement(\"div\", {\n      className: \"sidebarright-bordertwo\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 695\n      },\n      __self: this\n    }) : null, React.createElement(\"div\", {\n      className: \"sidebarright-authority\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 696\n      },\n      __self: this\n    }, React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 697\n      },\n      __self: this\n    }, \"Users\")), React.createElement(\"div\", {\n      className: \"sidebarright-bordertwo\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 699\n      },\n      __self: this\n    }), this.state.serverUserList.length > 0 ? this.state.serverUserList.map((user, index) => {\n      const moderate = user.username !== this.state.username;\n      return React.createElement(\"div\", {\n        key: index,\n        className: user.type === 'user' ? \"sidebarright-usercontainer\" : \"\",\n        onClick: this.handleClick,\n        onContextMenu: event => {\n          this.sideContextMenu(event, user);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 703\n        },\n        __self: this\n      }, user.type === 'user' ? React.createElement(\"div\", {\n        className: \"username\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 704\n        },\n        __self: this\n      }, React.createElement(\"img\", {\n        className: \"username-image\",\n        src: user.imageUrl ? user.imageUrl : chatot,\n        alt: \"username-icon\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 705\n        },\n        __self: this\n      })) : null, user.type === 'user' && user.active ? React.createElement(\"div\", {\n        className: \"userinfo-online\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 707\n        },\n        __self: this\n      }) : null, user.type === 'user' && !user.active ? React.createElement(\"div\", {\n        className: \"userinfo-offline\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 708\n        },\n        __self: this\n      }) : null, user.type === 'user' ? React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 710\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        className: \"sidebarright-user\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 711\n        },\n        __self: this\n      }, user.username), this.state.sideUserModalOpen && user.type === 'user' && this.state.sideRightClickedUser.username === user.username ? React.createElement(\"div\", {\n        ref: this.ref,\n        className: moderate === true ? \"chatarea-messages-sideusermodalmod\" : \"chatarea-messages-sideusermodal\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 713\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        onClick: () => {\n          this.setState({\n            sideUserModalOpen: false\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 714\n        },\n        __self: this\n      }, \"\\u2715\"), React.createElement(\"p\", {\n        onClick: () => {\n          this.sidePrivateMessageUser();\n        },\n        className: moderate === true ? \"chatarea-messages-sideusermodalmod-privatemessage\" : \"chatarea-messages-sideusermodal-privatemessage\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 715\n        },\n        __self: this\n      }, \"Send Message\"), moderate === true ? React.createElement(\"p\", {\n        onClick: () => {\n          this.kickUser(user);\n        },\n        className: \"chatarea-messages-sideusermodalmod-kick\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 717\n        },\n        __self: this\n      }, \"Kick \", user.username) : null, moderate === true ? React.createElement(\"p\", {\n        onClick: () => {\n          this.banUser(user);\n        },\n        className: \"chatarea-messages-sideusermodalmod-ban\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 719\n        },\n        __self: this\n      }, \"Ban \", user.username) : null) : null) : null);\n    }) : null));\n  }\n\n}\n\nfunction mapStateToProps({\n  usersReducer\n}) {\n  return {\n    error: usersReducer.error,\n    isLoading: usersReducer.isLoading,\n    success: usersReducer.success,\n    user: usersReducer.user,\n    users: usersReducer.users\n  };\n}\n\nexport default connect(mapStateToProps, actions)(Chatroom);","map":{"version":3,"sources":["/Users/metabou/Desktop/chatapp/client/src/components/Chatroom/Chatroom.js"],"names":["React","Component","connect","actions","ROOT_URL","io","Moment","chatot","numbersign","voice","editwhite","paperclip","emoji","EmojiPicker","Chatroom","constructor","props","useOnClickOutside","ref","handler","listener","event","current","contains","target","document","addEventListener","removeEventListener","recordAudioInput","stream","console","log","audioElements","getElementById","remoteAudio","createElement","style","display","srcObject","autoplay","appendChild","STUN","urls","TURN","credential","username","configuration","iceServers","setState","myConnection","RTCPeerConnection","getTracks","forEach","track","state","addTrack","onicecandidate","candidateQueue","remoteDescription","candidate","sdpMid","socket","emit","room","length","i","push","ontrack","streams","error","innerHTML","startCall","createCallerOffer","signalingState","desc","createOffer","offerToReceiveAudio","offerToReceiveVideo","setCallerLocalDescription","setLocalDescription","sendOfferFromCaller","data","setCalleeRemoteDescription","setRemoteDescription","calleCreateAnswer","createAnswer","setCalleeLocalDescription","sendCallerDescription","setCallerRemoteDescription","sideContextMenu","item","preventDefault","sideRightClickedUser","sideUserModalOpen","contextMenu","rightClickedUser","userModalOpen","messageMenu","editingMessage","privateMessageUser","messages","sidePrivateMessageUser","openMessageMenu","editMessage","deleteChatroomMessage","message","userId","chatroomId","messageId","id","editChatroomMessage","newMessage","hover","detectEscape","keyCode","sendEditedMessage","kickUser","user","serverId","type","banUser","sendMessage","showEmojiPicker","handleEmojiClick","code","String","fromCodePoint","handleMessageChange","value","handleNewMessageChange","clickMainFile","mainFile","click","showMainFile","reader","FileReader","file","files","onloadend","result","readAsText","createRef","mainSubmit","active","imageUrl","users","clickedUsername","clickedType","privateMessages","personalMessages","userDetails","socketId","currentSocket","namespace","previousRoom","currentChatroom","serverUserList","isLoading","chunks","remoteConnection","voiceUsers","negotiating","componentDidMount","window","on","activeChatroomId","activeChatroom","navigator","userAgent","search","reverse","element","scrollIntoView","index","findIndex","x","leaveServer","refreshServerUsers","addIceCandidate","RTCIceCandidate","catch","err","componentWillReceiveProps","nextProps","undefined","userList","activeChatroomType","audioStream","localStream","componentWillUnmount","render","map","moderate","some","serverItem","handleClick","updatedAt","shiftKey","width","hideEmojiPicker","mapStateToProps","usersReducer","success"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport * as actions from '../../redux';\nimport { ROOT_URL } from '../../config/networkSettings';\nimport io from 'socket.io-client';\nimport Moment from 'react-moment';\nimport 'moment-timezone';\nimport './Chatroom.css';\nimport chatot from '../../assets/images/chatot.png';\nimport numbersign from '../../assets/images/numbersign.png';\nimport voice from '../../assets/images/voice.png';\nimport editwhite from '../../assets/images/editwhite.png';\nimport paperclip from '../../assets/images/paperclip.png';\nimport emoji from '../../assets/images/emoji.png';\nimport EmojiPicker from 'emoji-picker-react';\n\nclass Chatroom extends Component {\n  constructor(props) {\n    super(props);\n    this.ref = React.createRef();\n    this.useOnClickOutside(this.ref, () => this.setState({ messageMenu: false, userModalOpen: false, sideUserModalOpen: false, showEmojiPicker: false }));\n\n    // file upload\n    this.mainSubmit = React.createRef();\n    this.mainFile = React.createRef();\n\n    this.state = {\n      id: \"\",\n      username: \"\",\n      active: false,\n      type: \"\",\n      imageUrl: \"\",\n      message: \"\",\n      messages: [],\n      users: [],\n      clickedUsername: \"\",\n      clickedType: \"\",\n      privateMessages: [],\n      personalMessages: [],\n      userDetails: false,\n      socketId: \"\",\n      currentSocket: \"\",\n      rightClickedUser: {},\n      sideRightClickedUser: {},\n      sideUserModalOpen: false,\n      userModalOpen: false,\n      namespace: null,\n      room: null,\n      serverId: null,\n      previousRoom: null,\n      currentChatroom: null,\n      editMessage: null,\n      messageMenu: false,\n      editingMessage: null,\n      newMessage: \"\",\n      hover: \"\",\n      serverUserList: [],\n      isLoading: false,\n      chunks: [],\n      myConnection: null,\n      remoteConnection: null,\n      voiceUsers: [],\n      negotiating: false,\n      showEmojiPicker: false\n    }\n  }\n\n  useOnClickOutside = (ref, handler) => {\n    const listener = event => {\n      // Do nothing if clicking ref's element or descendent elements\n      if (!ref.current || ref.current.contains(event.target)) {\n        return;\n      }\n\n      handler(event);\n    };\n\n    document.addEventListener('mousedown', listener);\n    document.addEventListener('touchstart', listener);\n\n    return () => {\n      document.removeEventListener('mousedown', listener);\n      document.removeEventListener('touchstart', listener);\n    };\n  }\n\n  async componentDidMount() {\n    window.addEventListener('keydown', this.detectEscape);\n\n    this.socket = io(ROOT_URL);\n\n    this.socket.on('connect', () => {\n      this.setState({ serverUserList: this.props.serverUserList, socketId: this.socket.id, namespace: `${ROOT_URL}/${this.props.serverId}`, room: `${ROOT_URL}/chatroom/${this.props.serverId}/${this.props.activeChatroomId}`, previousRoom: `${ROOT_URL}/chatroom/${this.props.serverId}/${this.props.activeChatroomId}`, serverId: this.props.serverId, currentChatroom: this.props.activeChatroom, chatroomId: this.props.activeChatroomId, username: this.props.username });\n\n      this.socket.emit('GET_CHATROOM_MESSAGES', {\n        socketId: this.socket.id,\n        chatroomId: this.props.activeChatroomId,\n        previousRoom: `${ROOT_URL}/chatroom/${this.props.serverId}/${this.props.activeChatroomId}`,\n        room: `${ROOT_URL}/chatroom/${this.props.serverId}/${this.props.activeChatroomId}`\n      });\n    });\n\n    this.socket.on('RECEIVE_CHATROOM_MESSAGES', (data) => {\n      this.setState({ messageMenu: false, editMessage: null, editingMessage: null, newMessage: \"\" });\n      // scroll to latest message after rendering messages in firefox\n      if (navigator.userAgent.search(\"Firefox\") > -1 || navigator.userAgent.search(\"Edge\") > -1) {\n        this.setState({ messages: data.reverse() }, () => {\n          if (data && data.length > 0) {\n            const element = \"message\" + (this.state.messages.length - 1);\n            if (document.getElementById(element)) {\n              document.getElementById(element).scrollIntoView();\n            }\n          }\n        });\n      } else if (navigator.userAgent.search(\"Firefox\") < 0 || navigator.userAgent.search(\"Edge\") < 0) {\n        this.setState({ messages: data });\n      }\n    });\n\n    this.socket.on('RECEIVE_SERVER_LIST', (data) => {\n      const index = data.findIndex(x => x.username === this.state.username);\n      if (index < 0) {\n        this.props.leaveServer();\n      } else if (index > -1) {\n        this.props.refreshServerUsers();\n        this.setState({ userModalOpen: false, sideUserModalOpen: false, rightClickedUser: {}, sideRightClickedUser: {}, serverUserList: data });\n      }\n    });\n\n    // -- begin webrtc socket events -- //\n    this.socket.on('RECEIVE_ICE_CANDIDATE', async (data) => {\n      console.log('-- start receive ice candidate --');\n      console.log(data.candidate);\n      console.log('-- end receive ice candidate --');\n      await this.state.myConnection.addIceCandidate(new RTCIceCandidate(data.candidate)).catch(err => console.log(err));\n    });\n\n    this.socket.on('RECEIVE_OFFER', async (data) => {\n      console.log(data.username + ' =?= ' + this.state.username);\n\n      this.setCalleeRemoteDescription(data.desc);\n    });\n\n    this.socket.on('RECEIVE_ANSWER', async (data) => {\n      console.log(data.username + ' =?= ' + this.state.username);\n\n      this.setCallerRemoteDescription(data.desc);\n    });\n    // -- end webrtc socket events -- //\n  }\n\n  async componentWillReceiveProps(nextProps) {\n    if (nextProps.username) {\n      this.setState({ username: nextProps.username });\n    }\n    if (nextProps.serverUserList) {\n      this.setState({ serverUserList: nextProps.serverUserList });\n    }\n    if (nextProps.activeChatroomId !== this.state.chatroomId && this.state.chatroomId !== undefined) {\n      await this.setState({\n        previousRoom: `${ROOT_URL}/chatroom/${nextProps.serverId}/${this.state.chatroomId}`,\n        room: `${ROOT_URL}/chatroom/${nextProps.serverId}/${nextProps.activeChatroomId}`,\n        serverId: nextProps.serverId,\n        currentChatroom: nextProps.activeChatroom,\n        chatroomId: nextProps.activeChatroomId\n      });\n      this.socket.emit('GET_CHATROOM_MESSAGES', {\n        socketId: this.state.socketId,\n        chatroomId: nextProps.activeChatroomId,\n        previousRoom: `${ROOT_URL}/chatroom/${nextProps.serverId}/${this.state.chatroomId}`,\n        room: `${ROOT_URL}/chatroom/${nextProps.serverId}/${nextProps.activeChatroomId}`\n      });\n    }\n\n    if (nextProps.users && nextProps.users.length) {\n      const userList = [];\n      for (let i = 0; i < nextProps.users.length; i++) {\n        userList.push(nextProps.users[i]);\n      }\n      this.setState({ users: userList });\n    }\n\n    // -- start webrtc audio setup -- //\n    if (nextProps.activeChatroomType === \"voice\" && nextProps.audioStream) {\n      await this.setState({ localStream: nextProps.audioStream });\n      this.recordAudioInput(nextProps.audioStream);\n    }\n\n    if (nextProps.activeChatroomType !== \"voice\") {\n      await this.setState({ localStream: null });\n      this.recordAudioInput(null);\n    }\n    // -- end webrtc audio setup -- //\n  }\n\n  // -- start webrtc peer connection setup -- //\n  recordAudioInput = async (stream) => {\n    if (stream) {\n      try {\n        console.log('------ my stream -------');\n        console.log(stream);\n        console.log('------ end my stream -------');\n\n        const audioElements = document.getElementById('audioElements');\n        const remoteAudio = document.createElement('audio');\n        remoteAudio.style.display = \"none\";\n        remoteAudio.srcObject = stream;\n        remoteAudio.autoplay = true;\n        audioElements.appendChild(remoteAudio);\n\n        const STUN = {\n          urls: 'stun:stun.l.google.com:19302'\n        };\n\n        const TURN = {\n          urls: 'turn:turn.bistri.com:80',\n          credential: 'homeo',\n          username: 'homeo'\n        };\n\n        const configuration = {\n          iceServers: [STUN, TURN]\n        };\n\n        await this.setState({ myConnection: new RTCPeerConnection(configuration) });\n\n        await stream.getTracks().forEach((track) => {\n          this.state.myConnection.addTrack(track, stream);\n        });\n\n        this.state.myConnection.onicecandidate = (event) => {\n          const candidateQueue = [];\n          if (this.state.myConnection.remoteDescription) {\n            if (event.candidate && event.candidate.sdpMid !== \"0\") {\n              this.socket.emit('SEND_ICE_CANDIDATE', {\n                candidate: event.candidate,\n                room: this.state.room\n              });\n            }\n\n            if (candidateQueue && candidateQueue.length < 1) return;\n\n            for (let i = 0; i < candidateQueue.length; i++) {\n              this.socket.emit('SEND_ICE_CANDIDATE', {\n                candidate: event.candidate,\n                room: this.state.room\n              });\n            }\n          } else if (!this.state.myConnection.remoteDescription && event.candidate && event.candidate.sdpMid !== \"0\") {\n            candidateQueue.push(event.candidate);\n          }\n        }\n\n        this.state.myConnection.ontrack = (event) => {\n          console.log(event.streams[0]);\n          if (!event.streams[0]) return;\n          const audioElements = document.getElementById('audioElements');\n          const remoteAudio = document.createElement('audio');\n          remoteAudio.style.display = \"none\";\n          remoteAudio.srcObject = event.streams[0];\n          remoteAudio.autoplay = true;\n          audioElements.appendChild(remoteAudio);\n        };\n      } catch (error) {\n        console.log('error setting up RTCPeerConnection: ' + error);\n      }\n    } else {\n      const audioElements = document.getElementById('audioElements');\n      audioElements.innerHTML = '';\n    }\n  }\n\n  startCall = () => {\n    if (!this.state.myConnection) return;\n    this.createCallerOffer();\n  }\n\n  createCallerOffer = async () => {\n    console.log(`--- negotiating in ${this.state.myConnection.signalingState} ---`);\n\n    try {\n      const desc = await this.state.myConnection.createOffer({\n        offerToReceiveAudio: 1,\n        offerToReceiveVideo: 0\n      });\n      this.setCallerLocalDescription(desc);\n    } catch (error) {\n      console.log('error creating caller offer: ' + error);\n    }\n  }\n\n  setCallerLocalDescription = async (desc) => {\n    try {\n      await this.state.myConnection.setLocalDescription(desc);\n      console.log('-- start myConnection after setLocalDescription --');\n      console.log(this.state.myConnection);\n      console.log('-- end myConnection after setLocalDescription --');\n      this.sendOfferFromCaller(desc);\n    } catch (error) {\n      console.log('error setting caller local description: ' + error);\n    }\n  }\n\n  sendOfferFromCaller = (desc) => {\n    console.log('-- sendOfferFromCaller --');\n    const data = {\n      desc: desc,\n      username: this.state.username,\n      room: this.state.room\n    }\n\n    this.socket.emit('SEND_OFFER', data);\n  }\n\n  setCalleeRemoteDescription = async (desc) => {\n    console.log('-- setCalleeRemoteDescription --');\n    try {\n      await this.state.myConnection.setRemoteDescription(desc);\n      this.calleCreateAnswer();\n    } catch (error) {\n      console.log('error setting callee remote description: ' + error);\n    }\n  }\n\n  calleCreateAnswer = async () => {\n    console.log('-- calleeCreateAnswer --');\n    try {\n      const desc = await this.state.myConnection.createAnswer();\n      this.setCalleeLocalDescription(desc);\n    } catch (error) {\n      console.log('error creating callee answer: ' + error);\n    }\n  }\n\n  setCalleeLocalDescription = async (desc) => {\n    console.log('-- setCalleeLocalDescription --');\n    try {\n      await this.state.myConnection.setLocalDescription(desc);\n      this.sendCallerDescription(desc);\n    } catch (error) {\n      console.log('error setting callee local description: ' + error);\n    }\n  }\n\n  sendCallerDescription = (desc) => {\n    console.log('-- sendCallerDescription --');\n    const data = {\n      desc: desc,\n      username: this.state.username,\n      room: this.state.room\n    }\n\n    this.socket.emit('SEND_ANSWER', data);\n  }\n\n  setCallerRemoteDescription = async (desc) => {\n    console.log('-- setCallerRemoteDescription --');\n    try {\n      await this.state.myConnection.setRemoteDescription(desc);\n    } catch (error) {\n      console.log('error setting caller remote description: ' + error);\n    }\n  }\n  // -- end webrtc peer connection setup -- //\n\n  sideContextMenu = (event, item) => {\n    event.preventDefault();\n    this.setState({ sideRightClickedUser: item, sideUserModalOpen: true });\n  }\n\n  contextMenu = (event, item) => {\n    event.preventDefault();\n    this.setState({ rightClickedUser: item, userModalOpen: true, messageMenu: false, editingMessage: null });\n  }\n\n  privateMessageUser = () => {\n    this.setState({ messages: [] });\n    this.props.privateMessageUser(this.state.rightClickedUser);\n  }\n\n  sidePrivateMessageUser = () => {\n    this.setState({ messages: [] });\n    this.props.privateMessageUser(this.state.sideRightClickedUser);\n  }\n\n  openMessageMenu = (item) => {\n    this.setState({ messageMenu: true, editMessage: item });\n  }\n\n  deleteChatroomMessage = () => {\n    const data = {\n      username: this.props.username,\n      message: this.state.message,\n      userId: this.props.userId,\n      chatroomId: this.state.chatroomId,\n      messageId: this.state.editMessage.id,\n      room: this.state.room\n    };\n    this.socket.emit('DELETE_CHATROOM_MESSAGE', data);\n  }\n\n  editChatroomMessage = () => {\n    this.setState({ editingMessage: this.state.editMessage, newMessage: this.state.editMessage.message, hover: \"\" }, () => {\n      this.setState({ editMessage: null, messageMenu: false });\n    });\n  }\n\n  detectEscape = (event) => {\n    if (event.keyCode === 27 && !this.state.messageMenu) {\n      this.setState({ editingMessage: this.state.editMessage, newMessage: \"\" });\n    }\n  }\n\n  sendEditedMessage = (event) => {\n    event.preventDefault();\n    const data = {\n      username: this.props.username,\n      message: this.state.newMessage,\n      userId: this.props.userId,\n      chatroomId: this.state.chatroomId,\n      messageId: this.state.editingMessage.id,\n      room: this.state.room\n    };\n    this.socket.emit('EDIT_CHATROOM_MESSAGE', data);\n  }\n\n  kickUser = (user) => {\n    const data = {\n      serverId: this.state.serverId,\n      chatroomId: this.state.chatroomId,\n      type: 'user',\n      userId: user.userId,\n      room: this.state.room\n    };\n    this.socket.emit('KICK_SERVER_USER', data);\n  }\n\n  banUser = (user) => {\n    const data = {\n      serverId: this.state.serverId,\n      chatroomId: this.state.chatroomId,\n      type: 'user',\n      userId: user.userId,\n      room: this.state.room\n    };\n    this.socket.emit('BAN_SERVER_USER', data);\n  }\n\n  sendMessage = (event) => {\n    if (event && this.state.message !== \"\") {\n      event.preventDefault();\n      const data = {\n        username: this.props.username,\n        message: this.state.message,\n        userId: this.props.userId,\n        chatroomId: this.state.chatroomId,\n        room: this.state.room\n      };\n      this.socket.emit('CHATROOM_MESSAGE', data);\n      this.setState({ message: \"\" });\n    }\n  }\n\n  showEmojiPicker = () => {\n    let { showEmojiPicker } = this.state;\n    this.setState({ showEmojiPicker: !showEmojiPicker });\n  }\n\n  handleEmojiClick = (code) => {\n    this.setState({\n      message: this.state.message + String.fromCodePoint(\"0x\" + code)\n    });\n  }\n\n  handleMessageChange = (event) => {\n    if (event.target.value.length < 500) {\n      this.setState({ message: event.target.value });\n    }\n  }\n\n  handleNewMessageChange = (event) => {\n    if (event.target.value.length < 500) {\n      this.setState({ newMessage: event.target.value });\n    }\n  }\n\n  componentWillUnmount() {\n    this.socket.emit('LEAVE_CHATROOMS', {\n      room: this.state.room\n    });\n  }\n\n  clickMainFile = () => {\n    console.log('clicked');\n    console.log(this.mainFile);\n    this.mainFile.current.click();\n  }\n\n  showMainFile = (event) => {\n    console.log('attachment open');\n    event.preventDefault();\n    let reader = new FileReader();\n    let file = event.target.files[0];\n\n    // console.log(file);\n    reader.onloadend = () => {\n      console.log(file);\n      console.log(reader.result);\n      // setMainFile(file);\n      // setEditImageUrl(reader.result);\n    }\n    reader.readAsText(file);\n  }\n\n  render() {\n    return (\n      <div className=\"chatroom\">\n        <div id=\"audioElements\"></div>\n        <div className=\"chatarea\">\n          <div className=\"chatarea-topbar\" onClick={() => { this.startCall(); }}>\n            <img src={this.props.activeChatroomType === \"text\" ? numbersign : voice} alt=\"channel\" height={16} width={16} /><span>{this.props.activeChatroom}</span>\n          </div>\n          <div id=\"chatareamessages\" className=\"chatarea-messages\">\n            {this.state.messages && this.state.messages.length > 0 ? this.state.messages.map((item, index) => {\n              const moderate = (this.state.serverUserList.length > 0\n                && this.state.serverUserList.some(serverItem => serverItem['username'] !== this.state.username\n                  && (serverItem['username'] === item.username && serverItem['type'] !== 'owner' && serverItem['type'] !== 'admin')));\n              return (\n                <div id={\"message\" + index} key={index} onMouseEnter={() => { this.setState({ hover: (this.state.editingMessage || this.state.messageMenu || (this.props.userId !== item.userId)) ? \"\" : (\"message\" + index) }) }} onMouseLeave={() => { this.setState({ hover: \"\" }); }}>\n                  <div className=\"chatarea-messages-container\">\n                    <span className=\"chatarea-messages-user\" onClick={this.handleClick} onContextMenu={(event) => { this.contextMenu(event, item); }}>{item.username}</span>\n                    <Moment format=\"MM/DD/YYYY\" date={item.updatedAt} className=\"chatarea-messages-time\" />\n                    {this.state.hover === (\"message\" + index) ? <span className=\"chatarea-messages-menu\" onClick={() => { this.openMessageMenu(item); }}><img src={editwhite} height={15} width={15} alt=\"edit message\" /></span> : null}\n                    {this.state.messageMenu && this.state.editMessage.id === item.id ?\n                      <div className=\"chatarea-messages-editmenu\" ref={this.ref}>\n                        <span onClick={() => { this.setState({ editMessage: null, messageMenu: false }); }}>&#10005;</span>\n                        <p onClick={() => { this.editChatroomMessage(); }}>Edit</p>\n                        <p onClick={() => { this.deleteChatroomMessage(); }}>Delete</p>\n                      </div>\n                      : null}\n                    {this.state.userModalOpen && this.state.rightClickedUser.id === item.id ?\n                      <div ref={this.ref} className={moderate === true ? \"chatarea-messages-usermodalmod\" : \"chatarea-messages-usermodal\"}>\n                        <span onClick={() => { this.setState({ userModalOpen: false }); }}>&#10005;</span>\n                        <p onClick={() => { this.privateMessageUser(); }} className={moderate === true ? \"chatarea-messages-usermodalmod-privatemessage\" : \"chatarea-messages-usermodal-privatemessage\"}>Send Message</p>\n\n                        {moderate === true ? <p onClick={() => { this.kickUser(item); }} className=\"chatarea-messages-usermodalmod-kick\">Kick {item.username}</p> : null}\n\n                        {moderate === true ? <p onClick={() => { this.banUser(item); }} className=\"chatarea-messages-usermodalmod-ban\">Ban {item.username}</p> : null}\n                      </div>\n                      : null}\n                  </div>\n                  {this.state.editingMessage !== null && this.state.editingMessage.id === item.id ? <span><input className=\"chatarea-messages-editmessage\" onChange={(event) => { this.handleNewMessageChange(event); }} value={this.state.newMessage} onKeyDown={(event) => { event.keyCode === 13 && event.shiftKey === false ? this.sendEditedMessage(event) : this.sendMessage(null) }} /><p className=\"chatarea-messages-editmessage-note\">escape to cancel • enter to save</p></span> : <p className=\"chatarea-messages-message\">{item.message}</p>}\n                </div>\n              )\n            }) : null}\n          </div>\n          {this.state.showEmojiPicker ?\n            <div className=\"emojipickerchatroom\" ref={this.ref}>\n              <EmojiPicker\n                style={{ width: \"-webkit-fill-available\" }}\n                emojiResolution={32}\n                onEmojiClick={this.handleEmojiClick}\n              />\n            </div>\n            : null}\n          <div className=\"chatarea-container\">\n            <input id=\"file\" type=\"file\" style={{ display: 'none' }} ref={this.mainFile} onChange={(event) => { this.showMainFile(event); }} accept=\".txt\" />\n            <img src={paperclip} alt=\"paperclip-icon\" className=\"attach\" ref={this.mainSubmit} onClick={this.clickMainFile} />\n            <input placeholder=\"Send a message!\" type=\"text\" onChange={(event) => { this.handleMessageChange(event); }} value={this.state.message} onKeyDown={(event) => { event.keyCode === 13 && event.shiftKey === false ? this.sendMessage(event) : this.sendMessage(null) }}></input>\n            <img src={emoji} className=\"emojiselectchatroom\" onClick={() => { this.showEmojiPicker(); }} alt=\"emoji-picker-icon\" />\n          </div>\n        </div>\n        <div className=\"sidebarright\" onClick={() => { this.hideEmojiPicker() }}>\n          <div className=\"sidebarright-container\">\n            <input placeholder=\"Filter users in server\"></input>\n          </div>\n          <div className=\"sidebarright-border\" />\n          <div className=\"sidebarright-authority\">\n            <span>Room Owners</span>\n          </div>\n          <div className=\"sidebarright-bordertwo\" />\n          {this.state.serverUserList.length > 0 ? this.state.serverUserList.map((user, index) => {\n            return (\n              <div key={index} className={user.type === 'owner' ? \"sidebarright-usercontainer\" : \"\"} onClick={this.handleClick} onContextMenu={(event) => { this.sideContextMenu(event, user); }}>\n                {user.type === 'owner' ? <div className=\"username\">\n                  <img className=\"username-image\" src={user.imageUrl ? user.imageUrl : chatot} alt=\"username-icon\" />\n                </div> : null}\n                {user.type === 'owner' && user.active ? <div className=\"userinfo-online\"></div> : null}\n                {user.type === 'owner' && !user.active ? <div className=\"userinfo-offline\"></div> : null}\n                {user.type === 'owner' ?\n                  <div>\n                    <span className=\"sidebarright-user\">{user.username}</span>\n                    {this.state.sideUserModalOpen && user.type === 'owner' && this.state.sideRightClickedUser.username === user.username ?\n                      <div ref={this.ref} className=\"chatarea-messages-sideusermodal\">\n                        <span onClick={() => { this.setState({ sideUserModalOpen: false }); }}>&#10005;</span>\n                        <p onClick={() => { this.sidePrivateMessageUser(); }} className=\"chatarea-messages-sideusermodal-privatemessage\">Send Message</p>\n                      </div>\n                      : null}\n                  </div>\n                  : null}\n              </div>\n            );\n          }) : null}\n          {this.state.serverUserList.length > 0 && this.state.serverUserList.some(item => item['type'] === 'owner') ? <div className=\"sidebarright-bordertwo\" /> : null}\n          <div className=\"sidebarright-authority\">\n            <span>Administrators</span>\n          </div>\n          <div className=\"sidebarright-bordertwo\" />\n          {this.state.serverUserList.length > 0 ? this.state.serverUserList.map((user, index) => {\n            return (\n              <div key={index} className={user.type === 'admin' ? \"sidebarright-usercontainer\" : \"\"} onClick={this.handleClick} onContextMenu={(event) => { this.sideContextMenu(event, user); }}>\n                {user.type === 'admin' ? <div className=\"username\">\n                  <img className=\"username-image\" src={user.imageUrl ? user.imageUrl : chatot} alt=\"username-icon\" />\n                </div> : null}\n                {user.type === 'admin' && user.active ? <div className=\"userinfo-online\"></div> : null}\n                {user.type === 'admin' && !user.active ? <div className=\"userinfo-offline\"></div> : null}\n                {user.type === 'admin' ?\n                  <div>\n                    <span className=\"sidebarright-user\">{user.username}</span>\n                    {this.state.sideUserModalOpen && user.type === 'admin' && this.state.sideRightClickedUser.username === user.username ?\n                      <div ref={this.ref} className=\"chatarea-messages-sideusermodal\">\n                        <span onClick={() => { this.setState({ sideUserModalOpen: false }); }}>&#10005;</span>\n                        <p onClick={() => { this.sidePrivateMessageUser(); }} className=\"chatarea-messages-sideusermodal-privatemessage\">Send Message</p>\n                      </div>\n                      : null}\n                  </div>\n                  : null}\n              </div>\n            );\n          }) : null}\n          {this.state.serverUserList.length > 0 && this.state.serverUserList.some(item => item['type'] === 'admin') ? <div className=\"sidebarright-bordertwo\" /> : null}\n          <div className=\"sidebarright-authority\">\n            <span>Moderators</span>\n          </div>\n          <div className=\"sidebarright-bordertwo\" />\n          {this.state.serverUserList.length > 0 ? this.state.serverUserList.map((user, index) => {\n            const moderate = (user.username !== this.state.username);\n            return (\n              <div key={index} className={user.type === 'moderator' ? \"sidebarright-usercontainer\" : \"\"} onClick={this.handleClick} onContextMenu={(event) => { this.sideContextMenu(event, user); }}>\n                {user.type === 'moderator' ? <div className=\"username\">\n                  <img className=\"username-image\" src={user.imageUrl ? user.imageUrl : chatot} alt=\"username-icon\" />\n                </div> : null}\n                {user.type === 'moderator' && user.active ? <div className=\"userinfo-online\"></div> : null}\n                {user.type === 'moderator' && !user.active ? <div className=\"userinfo-offline\"></div> : null}\n                {user.type === 'moderator' ?\n                  <div>\n                    <span className=\"sidebarright-user\">{user.username}</span>\n                    {this.state.sideUserModalOpen && user.type === 'moderator' && this.state.sideRightClickedUser.username === user.username ?\n                      <div ref={this.ref} className={moderate === true ? \"chatarea-messages-sideusermodalmod\" : \"chatarea-messages-sideusermodal\"}>\n                        <span onClick={() => { this.setState({ sideUserModalOpen: false }); }}>&#10005;</span>\n                        <p onClick={() => { this.sidePrivateMessageUser(); }} className={moderate === true ? \"chatarea-messages-sideusermodalmod-privatemessage\" : \"chatarea-messages-sideusermodal-privatemessage\"}>Send Message</p>\n\n                        {moderate === true ? <p onClick={() => { this.kickUser(user); }} className=\"chatarea-messages-sideusermodalmod-kick\">Kick {user.username}</p> : null}\n\n                        {moderate === true ? <p onClick={() => { this.banUser(user); }} className=\"chatarea-messages-sideusermodalmod-ban\">Ban {user.username}</p> : null}\n                      </div>\n                      : null}\n                  </div>\n                  : null}\n              </div>\n            );\n          }) : null}\n          {this.state.serverUserList.length > 0 && this.state.serverUserList.some(item => item['type'] === 'moderator') ? <div className=\"sidebarright-bordertwo\" /> : null}\n          <div className=\"sidebarright-authority\">\n            <span>Voice</span>\n          </div>\n          <div className=\"sidebarright-bordertwo\" />\n          {this.state.serverUserList.length > 0 ? this.state.serverUserList.map((user, index) => {\n            const moderate = (user.username !== this.state.username);\n            return (\n              <div key={index} className={user.type === 'voice' ? \"sidebarright-usercontainer\" : \"\"} onClick={this.handleClick} onContextMenu={(event) => { this.sideContextMenu(event, user); }}>\n                {user.type === 'voice' ? <div className=\"username\">\n                  <img className=\"username-image\" src={user.imageUrl ? user.imageUrl : chatot} alt=\"username-icon\" />\n                </div> : null}\n                {user.type === 'voice' && user.active ? <div className=\"userinfo-online\"></div> : null}\n                {user.type === 'voice' && !user.active ? <div className=\"userinfo-offline\"></div> : null}\n                {user.type === 'voice' ?\n                  <div>\n                    <span className=\"sidebarright-user\">{user.username}</span>\n                    {this.state.sideUserModalOpen && user.type === 'voice' && this.state.sideRightClickedUser.username === user.username ?\n                      <div ref={this.ref} className={moderate === true ? \"chatarea-messages-sideusermodalmod\" : \"chatarea-messages-sideusermodal\"}>\n                        <span onClick={() => { this.setState({ sideUserModalOpen: false }); }}>&#10005;</span>\n                        <p onClick={() => { this.sidePrivateMessageUser(); }} className={moderate === true ? \"chatarea-messages-sideusermodalmod-privatemessage\" : \"chatarea-messages-sideusermodal-privatemessage\"}>Send Message</p>\n\n                        {moderate === true ? <p onClick={() => { this.kickUser(user); }} className=\"chatarea-messages-sideusermodalmod-kick\">Kick {user.username}</p> : null}\n\n                        {moderate === true ? <p onClick={() => { this.banUser(user); }} className=\"chatarea-messages-sideusermodalmod-ban\">Ban {user.username}</p> : null}\n                      </div>\n                      : null}\n                  </div>\n                  : null}\n              </div>\n            );\n          }) : null}\n          {this.state.serverUserList.length > 0 && this.state.serverUserList.some(item => item['type'] === 'voice') ? <div className=\"sidebarright-bordertwo\" /> : null}\n          <div className=\"sidebarright-authority\">\n            <span>Users</span>\n          </div>\n          <div className=\"sidebarright-bordertwo\" />\n          {this.state.serverUserList.length > 0 ? this.state.serverUserList.map((user, index) => {\n            const moderate = (user.username !== this.state.username);\n            return (\n              <div key={index} className={user.type === 'user' ? \"sidebarright-usercontainer\" : \"\"} onClick={this.handleClick} onContextMenu={(event) => { this.sideContextMenu(event, user); }}>\n                {user.type === 'user' ? <div className=\"username\">\n                  <img className=\"username-image\" src={user.imageUrl ? user.imageUrl : chatot} alt=\"username-icon\" />\n                </div> : null}\n                {user.type === 'user' && user.active ? <div className=\"userinfo-online\"></div> : null}\n                {user.type === 'user' && !user.active ? <div className=\"userinfo-offline\"></div> : null}\n                {user.type === 'user' ?\n                  <div>\n                    <span className=\"sidebarright-user\">{user.username}</span>\n                    {this.state.sideUserModalOpen && user.type === 'user' && this.state.sideRightClickedUser.username === user.username ?\n                      <div ref={this.ref} className={moderate === true ? \"chatarea-messages-sideusermodalmod\" : \"chatarea-messages-sideusermodal\"}>\n                        <span onClick={() => { this.setState({ sideUserModalOpen: false }); }}>&#10005;</span>\n                        <p onClick={() => { this.sidePrivateMessageUser(); }} className={moderate === true ? \"chatarea-messages-sideusermodalmod-privatemessage\" : \"chatarea-messages-sideusermodal-privatemessage\"}>Send Message</p>\n\n                        {moderate === true ? <p onClick={() => { this.kickUser(user); }} className=\"chatarea-messages-sideusermodalmod-kick\">Kick {user.username}</p> : null}\n\n                        {moderate === true ? <p onClick={() => { this.banUser(user); }} className=\"chatarea-messages-sideusermodalmod-ban\">Ban {user.username}</p> : null}\n                      </div>\n                      : null}\n                  </div>\n                  : null}\n              </div>\n            )\n          }) : null}\n        </div>\n      </div>\n    );\n  }\n}\n\nfunction mapStateToProps({ usersReducer }) {\n  return {\n    error: usersReducer.error,\n    isLoading: usersReducer.isLoading,\n    success: usersReducer.success,\n    user: usersReducer.user,\n    users: usersReducer.users\n  };\n}\n\nexport default connect(mapStateToProps, actions)(Chatroom);"]},"metadata":{},"sourceType":"module"}