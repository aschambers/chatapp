{"ast":null,"code":"var _jsxFileName = \"/Users/metabou/Desktop/ChatterSanctum/chatapp/client/src/components/Chatroom/Chatroom.js\";\nimport React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport * as actions from '../../redux';\nimport { ROOT_URL } from '../../config/networkSettings';\nimport io from 'socket.io-client';\nimport Moment from 'react-moment';\nimport 'moment-timezone';\nimport './Chatroom.css';\nimport chatot from '../../assets/images/chatot.png';\nimport numbersign from '../../assets/images/numbersign.png';\nimport voice from '../../assets/images/voice.png';\nimport editwhite from '../../assets/images/editwhite.png';\n\nclass Chatroom extends Component {\n  constructor(props) {\n    super(props);\n\n    this.useOnClickOutside = (ref, handler) => {\n      const listener = event => {\n        // Do nothing if clicking ref's element or descendent elements\n        if (!ref.current || ref.current.contains(event.target)) {\n          return;\n        }\n\n        handler(event);\n      };\n\n      document.addEventListener('mousedown', listener);\n      document.addEventListener('touchstart', listener);\n      return () => {\n        document.removeEventListener('mousedown', listener);\n        document.removeEventListener('touchstart', listener);\n      };\n    };\n\n    this.recordAudioInput = async stream => {\n      if (stream) {\n        try {\n          const STUN = {\n            urls: 'stun:stun.l.google.com:19302'\n          };\n          const TURN = {\n            urls: 'turn:turn.bistri.com:80',\n            credential: 'homeo',\n            username: 'homeo'\n          };\n          const configuration = {\n            iceServers: [STUN, TURN]\n          };\n          await this.setState({\n            myConnection: new RTCPeerConnection(configuration)\n          });\n          await stream.getTracks().forEach(track => {\n            console.log(\"adding \".concat(track.kind, \" track\"));\n            this.state.myConnection.addTrack(track, stream);\n          });\n          console.log(this.state.myConnection);\n          debugger;\n\n          this.state.myConnection.onicecandidate = event => {\n            if (event.candidate && event.candidate.sdpMid !== \"0\") {\n              this.socket.emit('SEND_ICE_CANDIDATE', {\n                candidate: event.candidate\n              });\n            } else {\n              console.log('no ice candidates to send');\n            }\n          }; // on negotiation needed event\n\n\n          this.state.myConnection.onnegotiationneeded = async () => {\n            console.log(\"negotiating in \".concat(this.state.myConnection.signalingState));\n            if (this.state.negotiating) return;\n            if (this.state.myConnection.signalingState !== 'stable') return;\n            await this.setState({\n              negotiating: true\n            });\n            console.log('---- test ----');\n\n            try {\n              await this.state.myConnection.setLocalDescription((await this.state.myConnection.createOffer({\n                offerToReceiveAudio: 1,\n                offerToReceiveVideo: 0\n              })));\n              console.log(this.state.myConnection.localDescription);\n              let test = JSON.stringify(this.state.myConnection.localDescription);\n              console.log(test);\n              console.log(JSON.parse(test));\n              debugger;\n              const data = {\n                desc: test,\n                username: this.state.username\n              };\n              console.log('sending offer data: ' + data.desc);\n              debugger;\n              this.socket.emit('SEND_OFFER', data);\n              debugger;\n            } catch (err) {\n              console.error(err);\n            } finally {\n              this.state.negotiating = false;\n            }\n          };\n\n          this.state.myConnection.ontrack = event => {\n            const remoteAudio = document.getElementById('audio');\n            console.log(event); // don't set srcObject again if it is already set.\n\n            if (remoteAudio.srcObject) return;\n            remoteAudio.srcObject = event.streams[0];\n          };\n        } catch (error) {\n          console.log(error);\n        }\n      } else {\n        const localAudio = document.getElementById('localAudio');\n        localAudio.srcObject = null;\n        localAudio.autoplay = false;\n        const remoteAudio = document.getElementById('remoteAudio');\n        remoteAudio.srcObject = null;\n        remoteAudio.autoplay = false;\n      }\n    };\n\n    this.onCreateOfferSuccess = async () => {\n      try {\n        console.log(this.state.myConnection.localDescription);\n        const data = {\n          desc: this.state.myConnection.localDescription,\n          username: this.state.username\n        };\n        console.log('sending offer data: ' + data);\n        this.socket.emit('SEND_OFFER', data);\n      } catch (e) {\n        console.log('session desc error creating offer: ' + e);\n      }\n    };\n\n    this.onCreateAnswerSuccess = async (desc, username) => {\n      try {\n        await this.state.remoteConnection.setLocalDescription(desc);\n        await this.state.myConnection.setRemoteDescription(desc);\n        const data = {\n          desc: desc,\n          username: username\n        };\n        this.socket.emit('SEND_ANSWER', data);\n      } catch (e) {\n        console.log('create answer error: ' + e);\n      }\n    };\n\n    this.sendMessage = event => {\n      if (event) {\n        event.preventDefault();\n        const data = {\n          username: this.props.username,\n          message: this.state.message,\n          userId: this.props.userId,\n          chatroomId: this.state.chatroomId,\n          room: this.state.room\n        };\n        this.socket.emit('CHATROOM_MESSAGE', data);\n        this.setState({\n          message: \"\"\n        });\n      }\n    };\n\n    this.sideContextMenu = (event, item) => {\n      event.preventDefault();\n      this.setState({\n        sideRightClickedUser: item,\n        sideUserModalOpen: true\n      });\n    };\n\n    this.contextMenu = (event, item) => {\n      event.preventDefault();\n      this.setState({\n        rightClickedUser: item,\n        userModalOpen: true,\n        messageMenu: false,\n        editingMessage: null\n      });\n    };\n\n    this.privateMessageUser = () => {\n      this.setState({\n        messages: []\n      });\n      this.props.privateMessageUser(this.state.rightClickedUser);\n    };\n\n    this.sidePrivateMessageUser = () => {\n      this.setState({\n        messages: []\n      });\n      this.props.privateMessageUser(this.state.sideRightClickedUser);\n    };\n\n    this.openMessageMenu = item => {\n      this.setState({\n        messageMenu: true,\n        editMessage: item\n      });\n    };\n\n    this.deleteChatroomMessage = () => {\n      const data = {\n        username: this.props.username,\n        message: this.state.message,\n        userId: this.props.userId,\n        chatroomId: this.state.chatroomId,\n        messageId: this.state.editMessage.id,\n        room: this.state.room\n      };\n      this.socket.emit('DELETE_CHATROOM_MESSAGE', data);\n    };\n\n    this.editChatroomMessage = () => {\n      this.setState({\n        editingMessage: this.state.editMessage,\n        newMessage: this.state.editMessage.message,\n        hover: \"\"\n      }, () => {\n        this.setState({\n          editMessage: null,\n          messageMenu: false\n        });\n      });\n    };\n\n    this.detectEscape = event => {\n      if (event.keyCode === 27 && !this.state.messageMenu) {\n        this.setState({\n          editingMessage: this.state.editMessage,\n          newMessage: \"\"\n        });\n      }\n    };\n\n    this.sendEditedMessage = event => {\n      event.preventDefault();\n      const data = {\n        username: this.props.username,\n        message: this.state.newMessage,\n        userId: this.props.userId,\n        chatroomId: this.state.chatroomId,\n        messageId: this.state.editingMessage.id,\n        room: this.state.room\n      };\n      this.socket.emit('EDIT_CHATROOM_MESSAGE', data);\n    };\n\n    this.kickUser = user => {\n      const data = {\n        serverId: this.state.serverId,\n        chatroomId: this.state.chatroomId,\n        type: 'user',\n        userId: user.userId,\n        room: this.state.room\n      };\n      this.socket.emit('KICK_SERVER_USER', data);\n    };\n\n    this.banUser = user => {\n      const data = {\n        serverId: this.state.serverId,\n        chatroomId: this.state.chatroomId,\n        type: 'user',\n        userId: user.userId,\n        room: this.state.room\n      };\n      this.socket.emit('BAN_SERVER_USER', data);\n    };\n\n    this.ref = React.createRef();\n    this.useOnClickOutside(this.ref, () => this.setState({\n      messageMenu: false,\n      userModalOpen: false,\n      sideUserModalOpen: false\n    }));\n    this.state = {\n      id: \"\",\n      username: \"\",\n      active: false,\n      type: \"\",\n      imageUrl: \"\",\n      message: \"\",\n      messages: [],\n      users: [],\n      clickedUsername: \"\",\n      clickedType: \"\",\n      privateMessages: [],\n      personalMessages: [],\n      userDetails: false,\n      socketId: \"\",\n      currentSocket: \"\",\n      rightClickedUser: {},\n      sideRightClickedUser: {},\n      sideUserModalOpen: false,\n      userModalOpen: false,\n      namespace: null,\n      room: null,\n      serverId: null,\n      previousRoom: null,\n      currentChatroom: null,\n      editMessage: null,\n      messageMenu: false,\n      editingMessage: null,\n      newMessage: \"\",\n      hover: \"\",\n      serverUserList: [],\n      isLoading: false,\n      chunks: [],\n      myConnection: null,\n      remoteConnection: null,\n      voiceUsers: [],\n      negotiating: false\n    };\n  }\n\n  async componentDidMount() {\n    window.addEventListener('keydown', this.detectEscape);\n    this.props.getUsers();\n    this.socket = io(ROOT_URL);\n    this.socket.on('connect', () => {\n      this.setState({\n        serverUserList: this.props.serverUserList,\n        socketId: this.socket.id,\n        namespace: \"\".concat(ROOT_URL, \"/\").concat(this.props.serverId),\n        room: \"\".concat(ROOT_URL, \"/chatroom/\").concat(this.props.serverId, \"/\").concat(this.props.activeChatroomId),\n        previousRoom: \"\".concat(ROOT_URL, \"/chatroom/\").concat(this.props.serverId, \"/\").concat(this.props.activeChatroomId),\n        serverId: this.props.serverId,\n        currentChatroom: this.props.activeChatroom,\n        chatroomId: this.props.activeChatroomId,\n        username: this.props.username\n      });\n      this.socket.emit('GET_CHATROOM_MESSAGES', {\n        socketId: this.socket.id,\n        chatroomId: this.props.activeChatroomId,\n        previousRoom: \"\".concat(ROOT_URL, \"/chatroom/\").concat(this.props.serverId, \"/\").concat(this.props.activeChatroomId),\n        room: \"\".concat(ROOT_URL, \"/chatroom/\").concat(this.props.serverId, \"/\").concat(this.props.activeChatroomId)\n      });\n      this.socket.emit('GET_SERVER_LIST', {\n        socketId: this.socket.id,\n        serverId: this.props.serverId,\n        previousRoom: \"\".concat(ROOT_URL, \"/chatroom/\").concat(this.props.serverId, \"/\").concat(this.props.activeChatroomId),\n        room: \"\".concat(ROOT_URL, \"/chatroom/\").concat(this.props.serverId, \"/\").concat(this.props.activeChatroomId)\n      });\n    });\n    this.socket.on('RECEIVE_CHATROOM_MESSAGES', data => {\n      this.setState({\n        messageMenu: false,\n        editMessage: null,\n        editingMessage: null,\n        newMessage: \"\"\n      }); // scroll to latest message after rendering messages in firefox\n\n      if (navigator.userAgent.search(\"Firefox\") > -1 || navigator.userAgent.search(\"Edge\") > -1) {\n        this.setState({\n          messages: data.reverse()\n        }, () => {\n          if (data && data.length > 0) {\n            const element = \"message\" + (this.state.messages.length - 1);\n\n            if (document.getElementById(element)) {\n              document.getElementById(element).scrollIntoView();\n            }\n          }\n        });\n      } else if (navigator.userAgent.search(\"Firefox\") < 0 || navigator.userAgent.search(\"Edge\") < 0) {\n        this.setState({\n          messages: data\n        });\n      }\n    });\n    this.socket.on('RECEIVE_SERVER_LIST', data => {\n      const index = data.findIndex(x => x.username === this.state.username);\n\n      if (index < 0) {\n        this.props.leaveServer();\n      } else if (index > -1) {\n        this.props.refreshServerUsers();\n        this.setState({\n          userModalOpen: false,\n          sideUserModalOpen: false,\n          rightClickedUser: {},\n          sideRightClickedUser: {},\n          serverUserList: data\n        });\n      }\n    });\n    this.socket.on('RECEIVE_ICE_CANDIDATE', async candidate => {\n      await this.state.myConnection.addIceCandidate(new RTCIceCandidate(candidate)).catch(err => console.log(err));\n    });\n    this.socket.on('RECEIVE_OFFER', async data => {\n      if (data.username !== this.state.username) {\n        try {\n          const STUN = {\n            urls: 'stun:stun.l.google.com:19302'\n          };\n          const TURN = {\n            urls: 'turn:turn.bistri.com:80',\n            credential: 'homeo',\n            username: 'homeo'\n          };\n          const configuration = {\n            iceServers: [STUN, TURN]\n          };\n          const datadesc = await JSON.parse(data.desc);\n          console.log(datadesc);\n          await this.setState({\n            remoteConnection: new RTCPeerConnection(configuration)\n          });\n          await this.state.remoteConnection.setLocalDescription(datadesc);\n          debugger;\n          await this.state.myConnection.setRemoteDescription(datadesc);\n          debugger; // 3. Get stream\n          // const constraints = { audio: true, video: false };\n          // const stream = await navigator.mediaDevices.getUserMedia(constraints);\n          // if (!stream) return;\n          // const remoteAudio = document.getElementById('remoteAudio');\n          // remoteAudio.srcObject = stream;\n          // remoteAudio.autoplay = true;\n          // 4. Add tracks from stream\n          // await stream.getTracks().forEach(track => {\n          //   newConnection.addTrack(track, stream);\n          // });\n          // 5. Create answer to sdp offer\n\n          const answer = await this.state.myConnection.createAnswer();\n          if (!answer) return;\n          console.log(answer);\n          debugger; // 2. Set remote description with new RTCSessionDescription\n          // await this.state.myConnection.setRemoteDescription(answer);\n          // 6. Set local description using answer\n          // await newConnection.setLocalDescription(answer);\n          // 7. Send a message back to sender\n\n          const message = {\n            answer: answer,\n            username: data.username\n          };\n          this.socket.emit('SEND_ANSWER', message);\n        } catch (error) {\n          console.log('set remote desc error: ' + error);\n        }\n      }\n    });\n    this.socket.on('RECEIVE_ANSWER', async data => {\n      console.log('answer: ' + data.username);\n\n      if (data.username === this.state.username) {\n        console.log('receive answer data: ' + data); // Let my connection know how their connection is configured\n\n        try {\n          await this.state.myConnection.setRemoteDescription(new RTCSessionDescription(data.answer));\n        } catch (e) {\n          console.log('receive answer error: ' + e);\n        }\n      }\n    });\n  }\n\n  async componentWillReceiveProps(nextProps) {\n    if (nextProps.username) {\n      this.setState({\n        username: nextProps.username\n      });\n    }\n\n    if (nextProps.serverUserList) {\n      this.setState({\n        serverUserList: nextProps.serverUserList\n      });\n    }\n\n    if (nextProps.activeChatroomId !== this.state.chatroomId && this.state.chatroomId !== undefined) {\n      this.setState({\n        previousRoom: \"\".concat(ROOT_URL, \"/chatroom/\").concat(nextProps.serverId, \"/\").concat(this.state.chatroomId),\n        room: \"\".concat(ROOT_URL, \"/chatroom/\").concat(nextProps.serverId, \"/\").concat(nextProps.activeChatroomId),\n        serverId: nextProps.serverId,\n        currentChatroom: nextProps.activeChatroom,\n        chatroomId: nextProps.activeChatroomId\n      });\n      this.socket.emit('GET_CHATROOM_MESSAGES', {\n        socketId: this.state.socketId,\n        chatroomId: nextProps.activeChatroomId,\n        previousRoom: \"\".concat(ROOT_URL, \"/chatroom/\").concat(nextProps.serverId, \"/\").concat(this.state.chatroomId),\n        room: \"\".concat(ROOT_URL, \"/chatroom/\").concat(nextProps.serverId, \"/\").concat(nextProps.activeChatroomId)\n      });\n    }\n\n    if (nextProps.users && nextProps.users.length) {\n      const userList = [];\n\n      for (let i = 0; i < nextProps.users.length; i++) {\n        userList.push(nextProps.users[i]);\n      }\n\n      this.setState({\n        users: userList\n      });\n    }\n\n    if (nextProps.activeChatroomType === \"voice\" && nextProps.audioStream) {\n      this.setState({\n        localStream: nextProps.localStream\n      });\n      this.recordAudioInput(nextProps.audioStream);\n    }\n\n    if (nextProps.activeChatroomType !== \"voice\") {\n      this.setState({\n        localStream: null\n      });\n      this.recordAudioInput(null);\n    }\n  }\n\n  componentWillUnmount() {\n    this.socket.emit('LEAVE_CHATROOMS', {\n      room: this.state.room\n    });\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      className: \"chatroom\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 489\n      },\n      __self: this\n    }, React.createElement(\"audio\", {\n      id: \"localAudio\",\n      style: {\n        \"display\": \"none\"\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 490\n      },\n      __self: this\n    }), React.createElement(\"audio\", {\n      id: \"remoteAudio\",\n      style: {\n        \"display\": \"none\"\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 491\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      className: \"chatarea\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 492\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"chatarea-topbar\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 493\n      },\n      __self: this\n    }, React.createElement(\"img\", {\n      src: this.props.activeChatroomType === \"text\" ? numbersign : voice,\n      alt: \"channel\",\n      height: 16,\n      width: 16,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 494\n      },\n      __self: this\n    }), React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 494\n      },\n      __self: this\n    }, this.props.activeChatroom)), React.createElement(\"div\", {\n      id: \"chatareamessages\",\n      className: \"chatarea-messages\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 496\n      },\n      __self: this\n    }, this.state.messages && this.state.messages.length > 0 ? this.state.messages.map((item, index) => {\n      const moderate = this.state.serverUserList.length > 0 && this.state.serverUserList.some(serverItem => serverItem['username'] !== this.state.username && serverItem['username'] === item.username && serverItem['type'] !== 'owner' && serverItem['type'] !== 'admin');\n      return React.createElement(\"div\", {\n        id: \"message\" + index,\n        key: index,\n        onMouseEnter: () => {\n          this.setState({\n            hover: this.state.editingMessage || this.state.messageMenu || this.props.userId !== item.userId ? \"\" : \"message\" + index\n          });\n        },\n        onMouseLeave: () => {\n          this.setState({\n            hover: \"\"\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 502\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"chatarea-messages-container\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 503\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        className: \"chatarea-messages-user\",\n        onClick: this.handleClick,\n        onContextMenu: event => {\n          this.contextMenu(event, item);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 504\n        },\n        __self: this\n      }, item.username), React.createElement(Moment, {\n        format: \"MM/DD/YYYY\",\n        date: item.updatedAt,\n        className: \"chatarea-messages-time\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 505\n        },\n        __self: this\n      }), this.state.hover === \"message\" + index ? React.createElement(\"span\", {\n        className: \"chatarea-messages-menu\",\n        onClick: () => {\n          this.openMessageMenu(item);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 506\n        },\n        __self: this\n      }, React.createElement(\"img\", {\n        src: editwhite,\n        height: 15,\n        width: 15,\n        alt: \"edit message\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 506\n        },\n        __self: this\n      })) : null, this.state.messageMenu && this.state.editMessage.id === item.id ? React.createElement(\"div\", {\n        className: \"chatarea-messages-editmenu\",\n        ref: this.ref,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 508\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        onClick: () => {\n          this.setState({\n            editMessage: null,\n            messageMenu: false\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 509\n        },\n        __self: this\n      }, \"\\u2715\"), React.createElement(\"p\", {\n        onClick: () => {\n          this.editChatroomMessage();\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 510\n        },\n        __self: this\n      }, \"Edit\"), React.createElement(\"p\", {\n        onClick: () => {\n          this.deleteChatroomMessage();\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 511\n        },\n        __self: this\n      }, \"Delete\")) : null, this.state.userModalOpen && this.state.rightClickedUser.id === item.id ? React.createElement(\"div\", {\n        ref: this.ref,\n        className: moderate === true ? \"chatarea-messages-usermodalmod\" : \"chatarea-messages-usermodal\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 515\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        onClick: () => {\n          this.setState({\n            userModalOpen: false\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 516\n        },\n        __self: this\n      }, \"\\u2715\"), React.createElement(\"p\", {\n        onClick: () => {\n          this.privateMessageUser();\n        },\n        className: moderate === true ? \"chatarea-messages-usermodalmod-privatemessage\" : \"chatarea-messages-usermodal-privatemessage\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 517\n        },\n        __self: this\n      }, \"Send Message\"), moderate === true ? React.createElement(\"p\", {\n        onClick: () => {\n          this.kickUser(item);\n        },\n        className: \"chatarea-messages-usermodalmod-kick\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 519\n        },\n        __self: this\n      }, \"Kick \", item.username) : null, moderate === true ? React.createElement(\"p\", {\n        onClick: () => {\n          this.banUser(item);\n        },\n        className: \"chatarea-messages-usermodalmod-ban\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 521\n        },\n        __self: this\n      }, \"Ban \", item.username) : null) : null), this.state.editingMessage !== null && this.state.editingMessage.id === item.id ? React.createElement(\"span\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 525\n        },\n        __self: this\n      }, React.createElement(\"input\", {\n        className: \"chatarea-messages-editmessage\",\n        onChange: event => {\n          this.setState({\n            newMessage: event.target.value\n          });\n        },\n        value: this.state.newMessage,\n        onKeyDown: event => {\n          event.keyCode === 13 && event.shiftKey === false ? this.sendEditedMessage(event) : this.sendMessage(null);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 525\n        },\n        __self: this\n      }), React.createElement(\"p\", {\n        className: \"chatarea-messages-editmessage-note\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 525\n        },\n        __self: this\n      }, \"escape to cancel \\u2022 enter to save\")) : React.createElement(\"p\", {\n        className: \"chatarea-messages-message\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 525\n        },\n        __self: this\n      }, item.message));\n    }) : null), React.createElement(\"div\", {\n      className: \"chatarea-container\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 530\n      },\n      __self: this\n    }, React.createElement(\"input\", {\n      placeholder: \"Send a message!\",\n      type: \"text\",\n      onChange: event => {\n        this.setState({\n          message: event.target.value\n        });\n      },\n      value: this.state.message,\n      onKeyDown: event => {\n        event.keyCode === 13 && event.shiftKey === false ? this.sendMessage(event) : this.sendMessage(null);\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 531\n      },\n      __self: this\n    }))), React.createElement(\"div\", {\n      className: \"sidebarright\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 534\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"sidebarright-container\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 535\n      },\n      __self: this\n    }, React.createElement(\"input\", {\n      placeholder: \"Filter users in server\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 536\n      },\n      __self: this\n    })), React.createElement(\"div\", {\n      className: \"sidebarright-border\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 538\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      className: \"sidebarright-authority\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 539\n      },\n      __self: this\n    }, React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 540\n      },\n      __self: this\n    }, \"Room Owners\")), React.createElement(\"div\", {\n      className: \"sidebarright-bordertwo\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 542\n      },\n      __self: this\n    }), this.state.serverUserList.length > 0 ? this.state.serverUserList.map((user, index) => {\n      return React.createElement(\"div\", {\n        key: index,\n        className: user.type === 'owner' ? \"sidebarright-usercontainer\" : \"\",\n        onClick: this.handleClick,\n        onContextMenu: event => {\n          this.sideContextMenu(event, user);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 545\n        },\n        __self: this\n      }, user.type === 'owner' ? React.createElement(\"div\", {\n        className: \"username\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 546\n        },\n        __self: this\n      }, React.createElement(\"img\", {\n        className: \"username-image\",\n        src: user.imageUrl ? user.imageUrl : chatot,\n        alt: \"username-icon\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 547\n        },\n        __self: this\n      })) : null, user.type === 'owner' && user.active ? React.createElement(\"div\", {\n        className: \"userinfo-online\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 549\n        },\n        __self: this\n      }) : null, user.type === 'owner' && !user.active ? React.createElement(\"div\", {\n        className: \"userinfo-offline\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 550\n        },\n        __self: this\n      }) : null, user.type === 'owner' ? React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 552\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        className: \"sidebarright-user\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 553\n        },\n        __self: this\n      }, user.username), this.state.sideUserModalOpen && user.type === 'owner' && this.state.sideRightClickedUser.username === user.username ? React.createElement(\"div\", {\n        ref: this.ref,\n        className: \"chatarea-messages-sideusermodal\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 555\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        onClick: () => {\n          this.setState({\n            sideUserModalOpen: false\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 556\n        },\n        __self: this\n      }, \"\\u2715\"), React.createElement(\"p\", {\n        onClick: () => {\n          this.sidePrivateMessageUser();\n        },\n        className: \"chatarea-messages-sideusermodal-privatemessage\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 557\n        },\n        __self: this\n      }, \"Send Message\")) : null) : null);\n    }) : null, this.state.serverUserList.length > 0 && this.state.serverUserList.some(item => item['type'] === 'owner') ? React.createElement(\"div\", {\n      className: \"sidebarright-bordertwo\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 565\n      },\n      __self: this\n    }) : null, React.createElement(\"div\", {\n      className: \"sidebarright-authority\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 566\n      },\n      __self: this\n    }, React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 567\n      },\n      __self: this\n    }, \"Administrators\")), React.createElement(\"div\", {\n      className: \"sidebarright-bordertwo\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 569\n      },\n      __self: this\n    }), this.state.serverUserList.length > 0 ? this.state.serverUserList.map((user, index) => {\n      return React.createElement(\"div\", {\n        key: index,\n        className: user.type === 'admin' ? \"sidebarright-usercontainer\" : \"\",\n        onClick: this.handleClick,\n        onContextMenu: event => {\n          this.sideContextMenu(event, user);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 572\n        },\n        __self: this\n      }, user.type === 'admin' ? React.createElement(\"div\", {\n        className: \"username\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 573\n        },\n        __self: this\n      }, React.createElement(\"img\", {\n        className: \"username-image\",\n        src: user.imageUrl ? user.imageUrl : chatot,\n        alt: \"username-icon\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 574\n        },\n        __self: this\n      })) : null, user.type === 'admin' && user.active ? React.createElement(\"div\", {\n        className: \"userinfo-online\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 576\n        },\n        __self: this\n      }) : null, user.type === 'admin' && !user.active ? React.createElement(\"div\", {\n        className: \"userinfo-offline\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 577\n        },\n        __self: this\n      }) : null, user.type === 'admin' ? React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 579\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        className: \"sidebarright-user\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 580\n        },\n        __self: this\n      }, user.username), this.state.sideUserModalOpen && user.type === 'admin' && this.state.sideRightClickedUser.username === user.username ? React.createElement(\"div\", {\n        ref: this.ref,\n        className: \"chatarea-messages-sideusermodal\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 582\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        onClick: () => {\n          this.setState({\n            sideUserModalOpen: false\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 583\n        },\n        __self: this\n      }, \"\\u2715\"), React.createElement(\"p\", {\n        onClick: () => {\n          this.sidePrivateMessageUser();\n        },\n        className: \"chatarea-messages-sideusermodal-privatemessage\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 584\n        },\n        __self: this\n      }, \"Send Message\")) : null) : null);\n    }) : null, this.state.serverUserList.length > 0 && this.state.serverUserList.some(item => item['type'] === 'admin') ? React.createElement(\"div\", {\n      className: \"sidebarright-bordertwo\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 592\n      },\n      __self: this\n    }) : null, React.createElement(\"div\", {\n      className: \"sidebarright-authority\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 593\n      },\n      __self: this\n    }, React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 594\n      },\n      __self: this\n    }, \"Moderators\")), React.createElement(\"div\", {\n      className: \"sidebarright-bordertwo\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 596\n      },\n      __self: this\n    }), this.state.serverUserList.length > 0 ? this.state.serverUserList.map((user, index) => {\n      const moderate = user.username !== this.state.username;\n      return React.createElement(\"div\", {\n        key: index,\n        className: user.type === 'moderator' ? \"sidebarright-usercontainer\" : \"\",\n        onClick: this.handleClick,\n        onContextMenu: event => {\n          this.sideContextMenu(event, user);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 600\n        },\n        __self: this\n      }, user.type === 'moderator' ? React.createElement(\"div\", {\n        className: \"username\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 601\n        },\n        __self: this\n      }, React.createElement(\"img\", {\n        className: \"username-image\",\n        src: user.imageUrl ? user.imageUrl : chatot,\n        alt: \"username-icon\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 602\n        },\n        __self: this\n      })) : null, user.type === 'moderator' && user.active ? React.createElement(\"div\", {\n        className: \"userinfo-online\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 604\n        },\n        __self: this\n      }) : null, user.type === 'moderator' && !user.active ? React.createElement(\"div\", {\n        className: \"userinfo-offline\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 605\n        },\n        __self: this\n      }) : null, user.type === 'moderator' ? React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 607\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        className: \"sidebarright-user\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 608\n        },\n        __self: this\n      }, user.username), this.state.sideUserModalOpen && user.type === 'moderator' && this.state.sideRightClickedUser.username === user.username ? React.createElement(\"div\", {\n        ref: this.ref,\n        className: moderate === true ? \"chatarea-messages-sideusermodalmod\" : \"chatarea-messages-sideusermodal\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 610\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        onClick: () => {\n          this.setState({\n            sideUserModalOpen: false\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 611\n        },\n        __self: this\n      }, \"\\u2715\"), React.createElement(\"p\", {\n        onClick: () => {\n          this.sidePrivateMessageUser();\n        },\n        className: moderate === true ? \"chatarea-messages-sideusermodalmod-privatemessage\" : \"chatarea-messages-sideusermodal-privatemessage\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 612\n        },\n        __self: this\n      }, \"Send Message\"), moderate === true ? React.createElement(\"p\", {\n        onClick: () => {\n          this.kickUser(user);\n        },\n        className: \"chatarea-messages-sideusermodalmod-kick\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 614\n        },\n        __self: this\n      }, \"Kick \", user.username) : null, moderate === true ? React.createElement(\"p\", {\n        onClick: () => {\n          this.banUser(user);\n        },\n        className: \"chatarea-messages-sideusermodalmod-ban\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 616\n        },\n        __self: this\n      }, \"Ban \", user.username) : null) : null) : null);\n    }) : null, this.state.serverUserList.length > 0 && this.state.serverUserList.some(item => item['type'] === 'moderator') ? React.createElement(\"div\", {\n      className: \"sidebarright-bordertwo\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 624\n      },\n      __self: this\n    }) : null, React.createElement(\"div\", {\n      className: \"sidebarright-authority\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 625\n      },\n      __self: this\n    }, React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 626\n      },\n      __self: this\n    }, \"Voice\")), React.createElement(\"div\", {\n      className: \"sidebarright-bordertwo\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 628\n      },\n      __self: this\n    }), this.state.serverUserList.length > 0 ? this.state.serverUserList.map((user, index) => {\n      const moderate = user.username !== this.state.username;\n      return React.createElement(\"div\", {\n        key: index,\n        className: user.type === 'voice' ? \"sidebarright-usercontainer\" : \"\",\n        onClick: this.handleClick,\n        onContextMenu: event => {\n          this.sideContextMenu(event, user);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 632\n        },\n        __self: this\n      }, user.type === 'voice' ? React.createElement(\"div\", {\n        className: \"username\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 633\n        },\n        __self: this\n      }, React.createElement(\"img\", {\n        className: \"username-image\",\n        src: user.imageUrl ? user.imageUrl : chatot,\n        alt: \"username-icon\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 634\n        },\n        __self: this\n      })) : null, user.type === 'voice' && user.active ? React.createElement(\"div\", {\n        className: \"userinfo-online\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 636\n        },\n        __self: this\n      }) : null, user.type === 'voice' && !user.active ? React.createElement(\"div\", {\n        className: \"userinfo-offline\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 637\n        },\n        __self: this\n      }) : null, user.type === 'voice' ? React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 639\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        className: \"sidebarright-user\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 640\n        },\n        __self: this\n      }, user.username), this.state.sideUserModalOpen && user.type === 'voice' && this.state.sideRightClickedUser.username === user.username ? React.createElement(\"div\", {\n        ref: this.ref,\n        className: moderate === true ? \"chatarea-messages-sideusermodalmod\" : \"chatarea-messages-sideusermodal\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 642\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        onClick: () => {\n          this.setState({\n            sideUserModalOpen: false\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 643\n        },\n        __self: this\n      }, \"\\u2715\"), React.createElement(\"p\", {\n        onClick: () => {\n          this.sidePrivateMessageUser();\n        },\n        className: moderate === true ? \"chatarea-messages-sideusermodalmod-privatemessage\" : \"chatarea-messages-sideusermodal-privatemessage\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 644\n        },\n        __self: this\n      }, \"Send Message\"), moderate === true ? React.createElement(\"p\", {\n        onClick: () => {\n          this.kickUser(user);\n        },\n        className: \"chatarea-messages-sideusermodalmod-kick\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 646\n        },\n        __self: this\n      }, \"Kick \", user.username) : null, moderate === true ? React.createElement(\"p\", {\n        onClick: () => {\n          this.banUser(user);\n        },\n        className: \"chatarea-messages-sideusermodalmod-ban\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 648\n        },\n        __self: this\n      }, \"Ban \", user.username) : null) : null) : null);\n    }) : null, this.state.serverUserList.length > 0 && this.state.serverUserList.some(item => item['type'] === 'voice') ? React.createElement(\"div\", {\n      className: \"sidebarright-bordertwo\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 656\n      },\n      __self: this\n    }) : null, React.createElement(\"div\", {\n      className: \"sidebarright-authority\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 657\n      },\n      __self: this\n    }, React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 658\n      },\n      __self: this\n    }, \"Users\")), React.createElement(\"div\", {\n      className: \"sidebarright-bordertwo\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 660\n      },\n      __self: this\n    }), this.state.serverUserList.length > 0 ? this.state.serverUserList.map((user, index) => {\n      const moderate = user.username !== this.state.username;\n      return React.createElement(\"div\", {\n        key: index,\n        className: user.type === 'user' ? \"sidebarright-usercontainer\" : \"\",\n        onClick: this.handleClick,\n        onContextMenu: event => {\n          this.sideContextMenu(event, user);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 664\n        },\n        __self: this\n      }, user.type === 'user' ? React.createElement(\"div\", {\n        className: \"username\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 665\n        },\n        __self: this\n      }, React.createElement(\"img\", {\n        className: \"username-image\",\n        src: user.imageUrl ? user.imageUrl : chatot,\n        alt: \"username-icon\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 666\n        },\n        __self: this\n      })) : null, user.type === 'user' && user.active ? React.createElement(\"div\", {\n        className: \"userinfo-online\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 668\n        },\n        __self: this\n      }) : null, user.type === 'user' && !user.active ? React.createElement(\"div\", {\n        className: \"userinfo-offline\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 669\n        },\n        __self: this\n      }) : null, user.type === 'user' ? React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 671\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        className: \"sidebarright-user\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 672\n        },\n        __self: this\n      }, user.username), this.state.sideUserModalOpen && user.type === 'user' && this.state.sideRightClickedUser.username === user.username ? React.createElement(\"div\", {\n        ref: this.ref,\n        className: moderate === true ? \"chatarea-messages-sideusermodalmod\" : \"chatarea-messages-sideusermodal\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 674\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        onClick: () => {\n          this.setState({\n            sideUserModalOpen: false\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 675\n        },\n        __self: this\n      }, \"\\u2715\"), React.createElement(\"p\", {\n        onClick: () => {\n          this.sidePrivateMessageUser();\n        },\n        className: moderate === true ? \"chatarea-messages-sideusermodalmod-privatemessage\" : \"chatarea-messages-sideusermodal-privatemessage\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 676\n        },\n        __self: this\n      }, \"Send Message\"), moderate === true ? React.createElement(\"p\", {\n        onClick: () => {\n          this.kickUser(user);\n        },\n        className: \"chatarea-messages-sideusermodalmod-kick\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 678\n        },\n        __self: this\n      }, \"Kick \", user.username) : null, moderate === true ? React.createElement(\"p\", {\n        onClick: () => {\n          this.banUser(user);\n        },\n        className: \"chatarea-messages-sideusermodalmod-ban\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 680\n        },\n        __self: this\n      }, \"Ban \", user.username) : null) : null) : null);\n    }) : null));\n  }\n\n}\n\nfunction mapStateToProps({\n  usersReducer\n}) {\n  return {\n    error: usersReducer.error,\n    isLoading: usersReducer.isLoading,\n    success: usersReducer.success,\n    user: usersReducer.user,\n    users: usersReducer.users\n  };\n}\n\nexport default connect(mapStateToProps, actions)(Chatroom);","map":{"version":3,"sources":["/Users/metabou/Desktop/ChatterSanctum/chatapp/client/src/components/Chatroom/Chatroom.js"],"names":["React","Component","connect","actions","ROOT_URL","io","Moment","chatot","numbersign","voice","editwhite","Chatroom","constructor","props","useOnClickOutside","ref","handler","listener","event","current","contains","target","document","addEventListener","removeEventListener","recordAudioInput","stream","STUN","urls","TURN","credential","username","configuration","iceServers","setState","myConnection","RTCPeerConnection","getTracks","forEach","track","console","log","kind","state","addTrack","onicecandidate","candidate","sdpMid","socket","emit","onnegotiationneeded","signalingState","negotiating","setLocalDescription","createOffer","offerToReceiveAudio","offerToReceiveVideo","localDescription","test","JSON","stringify","parse","data","desc","err","error","ontrack","remoteAudio","getElementById","srcObject","streams","localAudio","autoplay","onCreateOfferSuccess","e","onCreateAnswerSuccess","remoteConnection","setRemoteDescription","sendMessage","preventDefault","message","userId","chatroomId","room","sideContextMenu","item","sideRightClickedUser","sideUserModalOpen","contextMenu","rightClickedUser","userModalOpen","messageMenu","editingMessage","privateMessageUser","messages","sidePrivateMessageUser","openMessageMenu","editMessage","deleteChatroomMessage","messageId","id","editChatroomMessage","newMessage","hover","detectEscape","keyCode","sendEditedMessage","kickUser","user","serverId","type","banUser","createRef","active","imageUrl","users","clickedUsername","clickedType","privateMessages","personalMessages","userDetails","socketId","currentSocket","namespace","previousRoom","currentChatroom","serverUserList","isLoading","chunks","voiceUsers","componentDidMount","window","getUsers","on","activeChatroomId","activeChatroom","navigator","userAgent","search","reverse","length","element","scrollIntoView","index","findIndex","x","leaveServer","refreshServerUsers","addIceCandidate","RTCIceCandidate","catch","datadesc","answer","createAnswer","RTCSessionDescription","componentWillReceiveProps","nextProps","undefined","userList","i","push","activeChatroomType","audioStream","localStream","componentWillUnmount","render","map","moderate","some","serverItem","handleClick","updatedAt","value","shiftKey","mapStateToProps","usersReducer","success"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport * as actions from '../../redux';\nimport { ROOT_URL } from '../../config/networkSettings';\nimport io from 'socket.io-client';\nimport Moment from 'react-moment';\nimport 'moment-timezone';\nimport './Chatroom.css';\nimport chatot from '../../assets/images/chatot.png';\nimport numbersign from '../../assets/images/numbersign.png';\nimport voice from '../../assets/images/voice.png';\nimport editwhite from '../../assets/images/editwhite.png';\n\nclass Chatroom extends Component {\n  constructor(props) {\n    super(props);\n    this.ref = React.createRef();\n    this.useOnClickOutside(this.ref, () => this.setState({ messageMenu: false, userModalOpen: false, sideUserModalOpen: false }));\n\n    this.state = {\n      id: \"\",\n      username: \"\",\n      active: false,\n      type: \"\",\n      imageUrl: \"\",\n      message: \"\",\n      messages: [],\n      users: [],\n      clickedUsername: \"\",\n      clickedType: \"\",\n      privateMessages: [],\n      personalMessages: [],\n      userDetails: false,\n      socketId: \"\",\n      currentSocket: \"\",\n      rightClickedUser: {},\n      sideRightClickedUser: {},\n      sideUserModalOpen: false,\n      userModalOpen: false,\n      namespace: null,\n      room: null,\n      serverId: null,\n      previousRoom: null,\n      currentChatroom: null,\n      editMessage: null,\n      messageMenu: false,\n      editingMessage: null,\n      newMessage: \"\",\n      hover: \"\",\n      serverUserList: [],\n      isLoading: false,\n      chunks: [],\n      myConnection: null,\n      remoteConnection: null,\n      voiceUsers: [],\n      negotiating: false\n    }\n  }\n\n  useOnClickOutside = (ref, handler) => {\n    const listener = event => {\n      // Do nothing if clicking ref's element or descendent elements\n      if (!ref.current || ref.current.contains(event.target)) {\n        return;\n      }\n\n      handler(event);\n    };\n\n    document.addEventListener('mousedown', listener);\n    document.addEventListener('touchstart', listener);\n\n    return () => {\n      document.removeEventListener('mousedown', listener);\n      document.removeEventListener('touchstart', listener);\n    };\n  }\n\n  async componentDidMount() {\n    window.addEventListener('keydown', this.detectEscape);\n    this.props.getUsers();\n\n    this.socket = io(ROOT_URL);\n\n    this.socket.on('connect', () => {\n      this.setState({ serverUserList: this.props.serverUserList, socketId: this.socket.id, namespace: `${ROOT_URL}/${this.props.serverId}`, room: `${ROOT_URL}/chatroom/${this.props.serverId}/${this.props.activeChatroomId}`, previousRoom: `${ROOT_URL}/chatroom/${this.props.serverId}/${this.props.activeChatroomId}`, serverId: this.props.serverId, currentChatroom: this.props.activeChatroom, chatroomId: this.props.activeChatroomId, username: this.props.username });\n\n      this.socket.emit('GET_CHATROOM_MESSAGES', {\n        socketId: this.socket.id,\n        chatroomId: this.props.activeChatroomId,\n        previousRoom: `${ROOT_URL}/chatroom/${this.props.serverId}/${this.props.activeChatroomId}`,\n        room: `${ROOT_URL}/chatroom/${this.props.serverId}/${this.props.activeChatroomId}`\n      });\n\n      this.socket.emit('GET_SERVER_LIST', {\n        socketId: this.socket.id,\n        serverId: this.props.serverId,\n        previousRoom: `${ROOT_URL}/chatroom/${this.props.serverId}/${this.props.activeChatroomId}`,\n        room: `${ROOT_URL}/chatroom/${this.props.serverId}/${this.props.activeChatroomId}`\n      });\n    });\n\n    this.socket.on('RECEIVE_CHATROOM_MESSAGES', (data) => {\n      this.setState({ messageMenu: false, editMessage: null, editingMessage: null, newMessage: \"\" });\n      // scroll to latest message after rendering messages in firefox\n      if (navigator.userAgent.search(\"Firefox\") > -1 || navigator.userAgent.search(\"Edge\") > -1) {\n        this.setState({ messages: data.reverse() }, () => {\n          if (data && data.length > 0) {\n            const element = \"message\" + (this.state.messages.length - 1);\n            if (document.getElementById(element)) {\n              document.getElementById(element).scrollIntoView();\n            }\n          }\n        });\n      } else if (navigator.userAgent.search(\"Firefox\") < 0 || navigator.userAgent.search(\"Edge\") < 0) {\n        this.setState({ messages: data });\n      }\n    });\n\n    this.socket.on('RECEIVE_SERVER_LIST', (data) => {\n      const index = data.findIndex(x => x.username === this.state.username);\n      if (index < 0) {\n        this.props.leaveServer();\n      } else if (index > -1) {\n        this.props.refreshServerUsers();\n        this.setState({ userModalOpen: false, sideUserModalOpen: false, rightClickedUser: {}, sideRightClickedUser: {}, serverUserList: data });\n      }\n    });\n\n\n\n    this.socket.on('RECEIVE_ICE_CANDIDATE', async(candidate) => {\n      await this.state.myConnection.addIceCandidate(new RTCIceCandidate(candidate)).catch(err => console.log(err));\n    });\n\n    this.socket.on('RECEIVE_OFFER', async(data) => {\n      if (data.username !== this.state.username) {\n        try {\n          const STUN = {\n            urls: 'stun:stun.l.google.com:19302'\n          };\n\n          const TURN = {\n              urls: 'turn:turn.bistri.com:80',\n              credential: 'homeo',\n              username: 'homeo'\n          };\n\n          const configuration = {\n            iceServers: [STUN, TURN]\n          };\n\n          const datadesc = await JSON.parse(data.desc);\n          console.log(datadesc);\n\n          await this.setState({ remoteConnection: new RTCPeerConnection(configuration) });\n\n          await this.state.remoteConnection.setLocalDescription(datadesc);\n          debugger;\n\n          await this.state.myConnection.setRemoteDescription(datadesc);\n          debugger;\n\n          // 3. Get stream\n          // const constraints = { audio: true, video: false };\n          // const stream = await navigator.mediaDevices.getUserMedia(constraints);\n          // if (!stream) return;\n\n          // const remoteAudio = document.getElementById('remoteAudio');\n          // remoteAudio.srcObject = stream;\n          // remoteAudio.autoplay = true;\n\n          // 4. Add tracks from stream\n          // await stream.getTracks().forEach(track => {\n          //   newConnection.addTrack(track, stream);\n          // });\n\n          // 5. Create answer to sdp offer\n          const answer = await this.state.myConnection.createAnswer();\n          if (!answer) return;\n\n          console.log(answer);\n          debugger;\n          // 2. Set remote description with new RTCSessionDescription\n          // await this.state.myConnection.setRemoteDescription(answer);\n\n          // 6. Set local description using answer\n          // await newConnection.setLocalDescription(answer);\n\n          // 7. Send a message back to sender\n          const message = {\n            answer: answer,\n            username: data.username\n          }\n          this.socket.emit('SEND_ANSWER', message);\n        } catch (error) {\n          console.log('set remote desc error: ' + error);\n        }\n      }\n    });\n\n    this.socket.on('RECEIVE_ANSWER', async(data) => {\n      console.log('answer: ' + data.username);\n      if (data.username === this.state.username) {\n        console.log('receive answer data: ' + data);\n        // Let my connection know how their connection is configured\n        try {\n          await this.state.myConnection.setRemoteDescription(new RTCSessionDescription(data.answer));\n        } catch (e) {\n          console.log('receive answer error: ' + e);\n        }\n      }\n    });\n  }\n\n  recordAudioInput = async(stream) => {\n    if (stream) {\n      try {\n\n        const STUN = {\n          urls: 'stun:stun.l.google.com:19302'\n        };\n\n        const TURN = {\n            urls: 'turn:turn.bistri.com:80',\n            credential: 'homeo',\n            username: 'homeo'\n        };\n\n        const configuration = {\n          iceServers: [STUN, TURN]\n        };\n\n        await this.setState({ myConnection: new RTCPeerConnection(configuration) });\n\n        await stream.getTracks().forEach((track) => {\n          console.log(`adding ${track.kind} track`);\n          this.state.myConnection.addTrack(track, stream);\n        });\n\n        console.log(this.state.myConnection);\n        debugger;\n\n        this.state.myConnection.onicecandidate = (event) => {\n          if (event.candidate && event.candidate.sdpMid !== \"0\") {\n            this.socket.emit('SEND_ICE_CANDIDATE', {\n              candidate: event.candidate\n            });\n          } else {\n            console.log('no ice candidates to send');\n          }\n        }\n\n        // on negotiation needed event\n        this.state.myConnection.onnegotiationneeded = async() => {\n          console.log(`negotiating in ${this.state.myConnection.signalingState}`);\n\n          if (this.state.negotiating) return;\n          if (this.state.myConnection.signalingState !== 'stable') return;\n          await this.setState({ negotiating: true });\n\n          console.log('---- test ----');\n\n          try {\n            await this.state.myConnection.setLocalDescription(await this.state.myConnection.createOffer({\n              offerToReceiveAudio: 1,\n              offerToReceiveVideo: 0\n            }));\n\n            console.log(this.state.myConnection.localDescription);\n            let test = JSON.stringify(this.state.myConnection.localDescription)\n            console.log(test);\n            console.log(JSON.parse(test));\n            debugger;\n\n            const data = {\n              desc: test,\n              username: this.state.username\n            }\n            console.log('sending offer data: ' + data.desc);\n            debugger;\n            this.socket.emit('SEND_OFFER', data);\n            debugger;\n          } catch (err) {\n            console.error(err);\n          } finally {\n            this.state.negotiating = false;\n          }\n        }\n\n        this.state.myConnection.ontrack = (event) => {\n          const remoteAudio = document.getElementById('audio');\n          console.log(event);\n          // don't set srcObject again if it is already set.\n          if (remoteAudio.srcObject) return;\n          remoteAudio.srcObject = event.streams[0];\n        };\n\n\n      } catch (error) {\n        console.log(error);\n      }\n    } else {\n      const localAudio = document.getElementById('localAudio');\n      localAudio.srcObject = null;\n      localAudio.autoplay = false;\n      const remoteAudio = document.getElementById('remoteAudio');\n      remoteAudio.srcObject = null;\n      remoteAudio.autoplay = false;\n    }\n  }\n\n  onCreateOfferSuccess = async() => {\n    try {\n      console.log(this.state.myConnection.localDescription);\n      const data = {\n        desc: this.state.myConnection.localDescription,\n        username: this.state.username\n      }\n      console.log('sending offer data: ' + data);\n      this.socket.emit('SEND_OFFER', data);\n    } catch (e) {\n      console.log('session desc error creating offer: ' + e);\n    }\n  }\n\n  onCreateAnswerSuccess = async(desc, username) => {\n    try {\n      await this.state.remoteConnection.setLocalDescription(desc);\n      await this.state.myConnection.setRemoteDescription(desc);\n      const data = {\n        desc: desc,\n        username: username\n      }\n      this.socket.emit('SEND_ANSWER', data);\n    } catch (e) {\n      console.log('create answer error: ' + e);\n    }\n  }\n\n  async componentWillReceiveProps(nextProps) {\n    if (nextProps.username) {\n      this.setState({ username: nextProps.username });\n    }\n    if (nextProps.serverUserList) {\n      this.setState({ serverUserList: nextProps.serverUserList });\n    }\n    if (nextProps.activeChatroomId !== this.state.chatroomId && this.state.chatroomId !== undefined) {\n      this.setState({\n        previousRoom: `${ROOT_URL}/chatroom/${nextProps.serverId}/${this.state.chatroomId}`,\n        room: `${ROOT_URL}/chatroom/${nextProps.serverId}/${nextProps.activeChatroomId}`,\n        serverId: nextProps.serverId,\n        currentChatroom: nextProps.activeChatroom,\n        chatroomId: nextProps.activeChatroomId\n      });\n      this.socket.emit('GET_CHATROOM_MESSAGES', {\n        socketId: this.state.socketId,\n        chatroomId: nextProps.activeChatroomId,\n        previousRoom: `${ROOT_URL}/chatroom/${nextProps.serverId}/${this.state.chatroomId}`,\n        room: `${ROOT_URL}/chatroom/${nextProps.serverId}/${nextProps.activeChatroomId}`\n      });\n    }\n\n    if (nextProps.users && nextProps.users.length) {\n      const userList = [];\n      for(let i = 0; i < nextProps.users.length; i++) {\n        userList.push(nextProps.users[i]);\n      }\n      this.setState({ users: userList });\n    }\n\n    if (nextProps.activeChatroomType === \"voice\" && nextProps.audioStream) {\n      this.setState({ localStream: nextProps.localStream });\n      this.recordAudioInput(nextProps.audioStream);\n    }\n\n    if (nextProps.activeChatroomType !== \"voice\") {\n      this.setState({ localStream: null });\n      this.recordAudioInput(null);\n    }\n  }\n\n  componentWillUnmount() {\n    this.socket.emit('LEAVE_CHATROOMS', {\n      room: this.state.room\n    });\n  }\n\n  sendMessage = (event) => {\n    if (event) {\n      event.preventDefault();\n      const data = {\n        username: this.props.username,\n        message: this.state.message,\n        userId: this.props.userId,\n        chatroomId: this.state.chatroomId,\n        room: this.state.room\n      };\n      this.socket.emit('CHATROOM_MESSAGE', data);\n      this.setState({ message: \"\" });\n    }\n  }\n\n  sideContextMenu = (event, item) => {\n    event.preventDefault();\n    this.setState({ sideRightClickedUser: item, sideUserModalOpen: true });\n  }\n\n  contextMenu = (event, item) => {\n    event.preventDefault();\n    this.setState({ rightClickedUser: item, userModalOpen: true, messageMenu: false, editingMessage: null });\n  }\n\n  privateMessageUser = () => {\n    this.setState({ messages: [] });\n    this.props.privateMessageUser(this.state.rightClickedUser);\n  }\n\n  sidePrivateMessageUser = () => {\n    this.setState({ messages: [] });\n    this.props.privateMessageUser(this.state.sideRightClickedUser);\n  }\n\n  openMessageMenu = (item) => {\n    this.setState({ messageMenu: true, editMessage: item });\n  }\n\n  deleteChatroomMessage = () => {\n    const data = {\n      username: this.props.username,\n      message: this.state.message,\n      userId: this.props.userId,\n      chatroomId: this.state.chatroomId,\n      messageId: this.state.editMessage.id,\n      room: this.state.room\n    };\n    this.socket.emit('DELETE_CHATROOM_MESSAGE', data);\n  }\n\n  editChatroomMessage = () => {\n    this.setState({ editingMessage: this.state.editMessage, newMessage: this.state.editMessage.message, hover: \"\" }, () => {\n      this.setState({ editMessage: null, messageMenu: false });\n    });\n  }\n\n  detectEscape = (event) => {\n    if (event.keyCode === 27 && !this.state.messageMenu) {\n      this.setState({ editingMessage: this.state.editMessage, newMessage: \"\" });\n    }\n  }\n\n  sendEditedMessage = (event) => {\n    event.preventDefault();\n    const data = {\n      username: this.props.username,\n      message: this.state.newMessage,\n      userId: this.props.userId,\n      chatroomId: this.state.chatroomId,\n      messageId: this.state.editingMessage.id,\n      room: this.state.room\n    };\n    this.socket.emit('EDIT_CHATROOM_MESSAGE', data);\n  }\n\n  kickUser = (user) => {\n    const data = {\n      serverId: this.state.serverId,\n      chatroomId: this.state.chatroomId,\n      type: 'user',\n      userId: user.userId,\n      room: this.state.room\n    };\n    this.socket.emit('KICK_SERVER_USER', data);\n  }\n\n  banUser = (user) => {\n    const data = {\n      serverId: this.state.serverId,\n      chatroomId: this.state.chatroomId,\n      type: 'user',\n      userId: user.userId,\n      room: this.state.room\n    };\n    this.socket.emit('BAN_SERVER_USER', data);\n  }\n\n  render() {\n    return (\n      <div className=\"chatroom\">\n        <audio id=\"localAudio\" style={{ \"display\": \"none\" }} />\n        <audio id=\"remoteAudio\" style={{ \"display\": \"none\" }} />\n        <div className=\"chatarea\">\n          <div className=\"chatarea-topbar\">\n            <img src={this.props.activeChatroomType === \"text\" ? numbersign : voice} alt=\"channel\" height={16} width={16} /><span>{this.props.activeChatroom}</span>\n          </div>\n          <div id=\"chatareamessages\" className=\"chatarea-messages\">\n            {this.state.messages && this.state.messages.length > 0 ? this.state.messages.map((item, index) => {\n              const moderate = (this.state.serverUserList.length > 0\n              && this.state.serverUserList.some(serverItem => serverItem['username'] !== this.state.username\n              && (serverItem['username'] === item.username && serverItem['type'] !== 'owner' && serverItem['type'] !== 'admin')));\n              return (\n                <div id={\"message\" + index} key={index} onMouseEnter={() => { this.setState({ hover: (this.state.editingMessage || this.state.messageMenu || (this.props.userId !== item.userId)) ? \"\" : (\"message\" + index) }) }} onMouseLeave={() => { this.setState({ hover: \"\" }); }}>\n                  <div className=\"chatarea-messages-container\">\n                    <span className=\"chatarea-messages-user\" onClick={this.handleClick} onContextMenu={(event) => { this.contextMenu(event, item); }}>{item.username}</span>\n                    <Moment format=\"MM/DD/YYYY\" date={item.updatedAt} className=\"chatarea-messages-time\" />\n                    {this.state.hover === (\"message\" + index) ? <span className=\"chatarea-messages-menu\" onClick={() => { this.openMessageMenu(item); }}><img src={editwhite} height={15} width={15} alt=\"edit message\" /></span> : null}\n                    {this.state.messageMenu && this.state.editMessage.id === item.id ?\n                      <div className=\"chatarea-messages-editmenu\" ref={this.ref}>\n                        <span onClick={() => { this.setState({ editMessage: null, messageMenu: false }); }}>&#10005;</span>\n                        <p onClick={() => { this.editChatroomMessage(); }}>Edit</p>\n                        <p onClick={() => { this.deleteChatroomMessage(); }}>Delete</p>\n                      </div>\n                    : null}\n                    {this.state.userModalOpen && this.state.rightClickedUser.id === item.id ?\n                      <div ref={this.ref} className={moderate === true ?\"chatarea-messages-usermodalmod\" : \"chatarea-messages-usermodal\"}>\n                        <span onClick={() => { this.setState({ userModalOpen: false }); }}>&#10005;</span>\n                        <p onClick={() => { this.privateMessageUser(); }} className={moderate === true ? \"chatarea-messages-usermodalmod-privatemessage\" : \"chatarea-messages-usermodal-privatemessage\"}>Send Message</p>\n\n                        {moderate === true ? <p onClick={() => { this.kickUser(item); }} className=\"chatarea-messages-usermodalmod-kick\">Kick {item.username}</p> : null}\n\n                        {moderate === true ? <p onClick={() => { this.banUser(item); }} className=\"chatarea-messages-usermodalmod-ban\">Ban {item.username}</p> : null}\n                      </div>\n                    : null}\n                  </div>\n                  {this.state.editingMessage !== null && this.state.editingMessage.id === item.id ? <span><input className=\"chatarea-messages-editmessage\" onChange={(event) => { this.setState({ newMessage: event.target.value }) }} value={this.state.newMessage} onKeyDown={(event) => { event.keyCode === 13 && event.shiftKey === false ? this.sendEditedMessage(event) : this.sendMessage(null) }} /><p className=\"chatarea-messages-editmessage-note\">escape to cancel • enter to save</p></span> : <p className=\"chatarea-messages-message\">{item.message}</p>}\n                </div>\n              )\n            }) : null}\n          </div>\n          <div className=\"chatarea-container\">\n            <input placeholder=\"Send a message!\" type=\"text\" onChange={(event) => { this.setState({ message: event.target.value }); }} value={this.state.message} onKeyDown={(event) => { event.keyCode === 13 && event.shiftKey === false ? this.sendMessage(event) : this.sendMessage(null) }}></input>\n          </div>\n        </div>\n        <div className=\"sidebarright\">\n          <div className=\"sidebarright-container\">\n            <input placeholder=\"Filter users in server\"></input>\n          </div>\n          <div className=\"sidebarright-border\" />\n          <div className=\"sidebarright-authority\">\n            <span>Room Owners</span>\n          </div>\n          <div className=\"sidebarright-bordertwo\" />\n          {this.state.serverUserList.length > 0 ? this.state.serverUserList.map((user, index)  => {\n            return (\n              <div key={index} className={user.type === 'owner' ? \"sidebarright-usercontainer\" : \"\"} onClick={this.handleClick} onContextMenu={(event) => { this.sideContextMenu(event, user); }}>\n                {user.type === 'owner' ? <div className=\"username\">\n                  <img className=\"username-image\" src={user.imageUrl ? user.imageUrl : chatot} alt=\"username-icon\" />\n                </div> : null}\n                {user.type === 'owner' && user.active ? <div className=\"userinfo-online\"></div> : null}\n                {user.type === 'owner' && !user.active ? <div className=\"userinfo-offline\"></div> : null}\n                {user.type === 'owner' ?\n                  <div>\n                    <span className=\"sidebarright-user\">{user.username}</span>\n                    {this.state.sideUserModalOpen && user.type === 'owner' && this.state.sideRightClickedUser.username === user.username ?\n                      <div ref={this.ref} className=\"chatarea-messages-sideusermodal\">\n                        <span onClick={() => { this.setState({ sideUserModalOpen: false }); }}>&#10005;</span>\n                        <p onClick={() => { this.sidePrivateMessageUser(); }} className=\"chatarea-messages-sideusermodal-privatemessage\">Send Message</p>\n                      </div>\n                    : null}\n                  </div>\n                : null}\n              </div>\n            );\n          }) : null}\n          {this.state.serverUserList.length > 0 && this.state.serverUserList.some(item => item['type'] === 'owner') ? <div className=\"sidebarright-bordertwo\" /> : null}\n          <div className=\"sidebarright-authority\">\n            <span>Administrators</span>\n          </div>\n          <div className=\"sidebarright-bordertwo\" />\n          {this.state.serverUserList.length > 0 ? this.state.serverUserList.map((user, index)  => {\n            return (\n              <div key={index} className={user.type === 'admin' ? \"sidebarright-usercontainer\" : \"\"} onClick={this.handleClick} onContextMenu={(event) => { this.sideContextMenu(event, user); }}>\n                {user.type === 'admin' ? <div className=\"username\">\n                  <img className=\"username-image\" src={user.imageUrl ? user.imageUrl : chatot} alt=\"username-icon\" />\n                </div> : null}\n                {user.type === 'admin' && user.active ? <div className=\"userinfo-online\"></div> : null}\n                {user.type === 'admin' && !user.active ? <div className=\"userinfo-offline\"></div> : null}\n                {user.type === 'admin' ?\n                  <div>\n                    <span className=\"sidebarright-user\">{user.username}</span>\n                    {this.state.sideUserModalOpen && user.type === 'admin' && this.state.sideRightClickedUser.username === user.username ?\n                      <div ref={this.ref} className=\"chatarea-messages-sideusermodal\">\n                        <span onClick={() => { this.setState({ sideUserModalOpen: false }); }}>&#10005;</span>\n                        <p onClick={() => { this.sidePrivateMessageUser(); }} className=\"chatarea-messages-sideusermodal-privatemessage\">Send Message</p>\n                      </div>\n                    : null}\n                  </div>\n                : null}\n              </div>\n            );\n          }) : null}\n          {this.state.serverUserList.length > 0 && this.state.serverUserList.some(item => item['type'] === 'admin') ? <div className=\"sidebarright-bordertwo\" /> : null}\n          <div className=\"sidebarright-authority\">\n            <span>Moderators</span>\n          </div>\n          <div className=\"sidebarright-bordertwo\" />\n          {this.state.serverUserList.length > 0 ? this.state.serverUserList.map((user, index)  => {\n            const moderate = (user.username !== this.state.username);\n            return (\n              <div key={index} className={user.type === 'moderator' ? \"sidebarright-usercontainer\" : \"\"} onClick={this.handleClick} onContextMenu={(event) => { this.sideContextMenu(event, user); }}>\n                {user.type === 'moderator' ? <div className=\"username\">\n                  <img className=\"username-image\" src={user.imageUrl ? user.imageUrl : chatot} alt=\"username-icon\" />\n                </div> : null}\n                {user.type === 'moderator' && user.active ? <div className=\"userinfo-online\"></div> : null}\n                {user.type === 'moderator' && !user.active ? <div className=\"userinfo-offline\"></div> : null}\n                {user.type === 'moderator' ?\n                  <div>\n                    <span className=\"sidebarright-user\">{user.username}</span>\n                    {this.state.sideUserModalOpen && user.type === 'moderator' && this.state.sideRightClickedUser.username === user.username ?\n                      <div ref={this.ref} className={moderate === true ?\"chatarea-messages-sideusermodalmod\" : \"chatarea-messages-sideusermodal\"}>\n                        <span onClick={() => { this.setState({ sideUserModalOpen: false }); }}>&#10005;</span>\n                        <p onClick={() => { this.sidePrivateMessageUser(); }} className={moderate === true ? \"chatarea-messages-sideusermodalmod-privatemessage\" : \"chatarea-messages-sideusermodal-privatemessage\"}>Send Message</p>\n\n                        {moderate === true ? <p onClick={() => { this.kickUser(user); }} className=\"chatarea-messages-sideusermodalmod-kick\">Kick {user.username}</p> : null}\n\n                        {moderate === true ? <p onClick={() => { this.banUser(user); }} className=\"chatarea-messages-sideusermodalmod-ban\">Ban {user.username}</p> : null}\n                      </div>\n                    : null}\n                  </div>\n                : null}\n              </div>\n            );\n          }) : null}\n          {this.state.serverUserList.length > 0 && this.state.serverUserList.some(item => item['type'] === 'moderator') ? <div className=\"sidebarright-bordertwo\" /> : null}\n          <div className=\"sidebarright-authority\">\n            <span>Voice</span>\n          </div>\n          <div className=\"sidebarright-bordertwo\" />\n          {this.state.serverUserList.length > 0 ? this.state.serverUserList.map((user, index) => {\n            const moderate = (user.username !== this.state.username);\n            return (\n              <div key={index} className={user.type === 'voice' ? \"sidebarright-usercontainer\" : \"\"} onClick={this.handleClick} onContextMenu={(event) => { this.sideContextMenu(event, user); }}>\n                {user.type === 'voice' ? <div className=\"username\">\n                  <img className=\"username-image\" src={user.imageUrl ? user.imageUrl : chatot} alt=\"username-icon\" />\n                </div> : null}\n                {user.type === 'voice' && user.active ? <div className=\"userinfo-online\"></div> : null}\n                {user.type === 'voice' && !user.active ? <div className=\"userinfo-offline\"></div> : null}\n                {user.type === 'voice' ?\n                  <div>\n                    <span className=\"sidebarright-user\">{user.username}</span>\n                    {this.state.sideUserModalOpen && user.type === 'voice' && this.state.sideRightClickedUser.username === user.username ?\n                      <div ref={this.ref} className={moderate === true ?\"chatarea-messages-sideusermodalmod\" : \"chatarea-messages-sideusermodal\"}>\n                        <span onClick={() => { this.setState({ sideUserModalOpen: false }); }}>&#10005;</span>\n                        <p onClick={() => { this.sidePrivateMessageUser(); }} className={moderate === true ? \"chatarea-messages-sideusermodalmod-privatemessage\" : \"chatarea-messages-sideusermodal-privatemessage\"}>Send Message</p>\n\n                        {moderate === true ? <p onClick={() => { this.kickUser(user); }} className=\"chatarea-messages-sideusermodalmod-kick\">Kick {user.username}</p> : null}\n\n                        {moderate === true ? <p onClick={() => { this.banUser(user); }} className=\"chatarea-messages-sideusermodalmod-ban\">Ban {user.username}</p> : null}\n                      </div>\n                    : null}\n                  </div>\n                : null}\n              </div>\n            );\n          }) : null}\n          {this.state.serverUserList.length > 0 && this.state.serverUserList.some(item => item['type'] === 'voice') ? <div className=\"sidebarright-bordertwo\" /> : null}\n          <div className=\"sidebarright-authority\">\n            <span>Users</span>\n          </div>\n          <div className=\"sidebarright-bordertwo\" />\n          {this.state.serverUserList.length > 0 ? this.state.serverUserList.map((user, index) => {\n            const moderate = (user.username !== this.state.username);\n            return (\n              <div key={index} className={user.type === 'user' ? \"sidebarright-usercontainer\" : \"\"} onClick={this.handleClick} onContextMenu={(event) => { this.sideContextMenu(event, user); }}>\n                {user.type === 'user' ? <div className=\"username\">\n                  <img className=\"username-image\" src={user.imageUrl ? user.imageUrl : chatot} alt=\"username-icon\" />\n                </div> : null}\n                {user.type === 'user' && user.active ? <div className=\"userinfo-online\"></div> : null}\n                {user.type === 'user' && !user.active ? <div className=\"userinfo-offline\"></div> : null}\n                {user.type === 'user' ?\n                  <div>\n                    <span className=\"sidebarright-user\">{user.username}</span>\n                    {this.state.sideUserModalOpen && user.type === 'user' && this.state.sideRightClickedUser.username === user.username ?\n                      <div ref={this.ref} className={moderate === true ?\"chatarea-messages-sideusermodalmod\" : \"chatarea-messages-sideusermodal\"}>\n                        <span onClick={() => { this.setState({ sideUserModalOpen: false }); }}>&#10005;</span>\n                        <p onClick={() => { this.sidePrivateMessageUser(); }} className={moderate === true ? \"chatarea-messages-sideusermodalmod-privatemessage\" : \"chatarea-messages-sideusermodal-privatemessage\"}>Send Message</p>\n\n                        {moderate === true ? <p onClick={() => { this.kickUser(user); }} className=\"chatarea-messages-sideusermodalmod-kick\">Kick {user.username}</p> : null}\n\n                        {moderate === true ? <p onClick={() => { this.banUser(user); }} className=\"chatarea-messages-sideusermodalmod-ban\">Ban {user.username}</p> : null}\n                      </div>\n                    : null}\n                  </div>\n                : null}\n              </div>\n            )\n          }) : null}\n        </div>\n      </div>\n    );\n  }\n}\n\nfunction mapStateToProps({ usersReducer }) {\n  return {\n    error: usersReducer.error,\n    isLoading: usersReducer.isLoading,\n    success: usersReducer.success,\n    user: usersReducer.user,\n    users: usersReducer.users\n  };\n}\n\nexport default connect(mapStateToProps, actions)(Chatroom);"]},"metadata":{},"sourceType":"module"}